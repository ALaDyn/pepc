HELP = "\
\# Makefile for OS X\n\
\# \n\
\# Some notes:\n\
\# - OS X ships without a Fortran compiler, this makefile assumes that gcc-4.8\n\
\#   including the Fortran front-end gfortran has been installed by the user.\n\
\# - The stock OpenMPI that comes with OS X does not include Fortran bindings\n\
\#   and Fortran compiler wrappers, these will have to be installed by the\n\
\#   user as well.\n\
\# - The system cpp in OS X is antiquated and thus whatever compiler hides\n\
\#   behind mpicc is (ab)used as the C preprocessor using the -E -x c flags.\n\
"

MACH     = osx_gcc-4.8

DEBUG    = 1
OMP      = 1

RANLIB   = ranlib

MAKE     = make

AR       = libtool
ARFLAGS  = -o

CPP      = mpicc
CPPFLAGS = -E -x c -P -C -DSVNREVISION="\"$(SVNREVISION)\""

INLINING = -fdump-ipa-inline -finline-functions-called-once -fearly-inlining -findirect-inlining -mstringop-strategy=unrolled_loop -flto-partition=none -finline-limit=120000 --param large-function-insns=120000 --param large-unit-insns=120000 --param large-function-growth=1000 --param inline-unit-growth=1000 --param max-inline-insns-recursive-auto=120000 --param max-inline-recursive-depth-auto=500 -fipa-matrix-reorg 
# -flto
#-fwhopr

ifeq ($(DEBUG), 1)
  FFLAGS   = -Wall -O0 -pg -g -gdwarf-3 -fcoarray=none -frecursive -ffree-line-length-none -frange-check -fbacktrace -fvar-tracking -pthread -C -Wconversion -fimplicit-none -Warray-temporaries -Wcharacter-truncation -Wline-truncation -Wimplicit-interface -Wimplicit-procedure -Wsurprising -Wfunction-elimination -Wrealloc-lhs-all -Wcompare-reals -fbacktrace -fcheck=all
  CFLAGS   = -Wall -O0 -pg -g -gdwarf-3
  LDFLAGS  =       -O0 -pg -g -gdwarf-3
else
  FFLAGS   = -Wall -O5 -pg    -fcoarray=none -frecursive  -ffree-line-length-none -fsign-zero -fno-protect-parens -faggressive-function-elimination $(INLINING)
  CFLAGS   = -Wall -O5 -pg
  LDFLAGS   = -pthread -pg -O5 $(INLINING) -fwhole-program  
#-Wl,--threads
#-fuse-linker-plugin
endif

ifeq ($(OMP), 1)
  FFLAGS   += -fopenmp
  LDFLAGS  += -fopenmp 
else
endif

FCPRE    = 
FC       = mpif90

CCPRE    = 
CC       = mpicc

LDPRE    = 
LD       = mpif90
LDLIBS   = 

RM       = rm -rf
