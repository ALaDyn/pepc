HELP = "\
\# Makefile for gcc 4.9 (self-compiled)\n\
"

MACH     = gcc-4.9

DEBUG    = 0
OMP      = 1

RANLIB   = ranlib

MAKE     = make

AR       = ar
ARFLAGS  = -rs

CPP      = cpp
CPPFLAGS = -P -C -DSVNREVISION="\"$(SVNREVISION)\""

INLINING = -fdump-ipa-inline -finline-functions-called-once -fearly-inlining -findirect-inlining -flto-partition=none -finline-limit=120000 --param large-function-insns=120000 --param large-unit-insns=120000 --param large-function-growth=1000 --param inline-unit-growth=1000 --param max-inline-insns-recursive-auto=120000 --param max-inline-recursive-depth-auto=500 -fipa-matrix-reorg 
#-flto -ffat-lto-objects

ifeq ($(DEBUG), 1)
  FFLAGS   = -gdwarf-3 -gstrict-dwarf -Wall -O0 -g -frecursive -ffree-line-length-none -frange-check -fbacktrace -fvar-tracking -pthread -C -Wconversion -fimplicit-none -Warray-temporaries -Wcharacter-truncation -Wline-truncation -Wextra -Wno-unused-parameter -Wsurprising -Wintrinsic-shadow -Wfunction-elimination -Wrealloc-lhs-all -fcheck=all
  CFLAGS   = -gdwarf-3 -gstrict-dwarf -Wall -O0 -g 
  LDFLAGS  = -gdwarf-3 -gstrict-dwarf       -O0 -g 
else
  FFLAGS   = -Wall -O5 -g -frecursive  -ffree-line-length-none -fsign-zero -fno-protect-parens -faggressive-function-elimination $(INLINING)
  CFLAGS   = -Wall -O5 -g
  LDFLAGS   = -pthread -g -O5 $(INLINING) -fwhole-file
  CPPFLAGS += -DNDEBUG
#-Wl,--threads
#-fuse-linker-plugin
endif

# solve the following issue with lto:
#`walk_worker_thread' referenced in section `.text' of /tmp/ccB14zE9.lto.o: defined in discarded section `.text' of module_walk_pthreads.o (symbol from plugin)
#`walk_worker_thread' referenced in section `.rodata' of /tmp/ccB14zE9.lto.o: defined in discarded section `.text' of module_walk_pthreads.o (symbol from plugin)
#`run_communication_loop' referenced in section `.rodata' of /tmp/ccB14zE9.lto.o: defined in discarded section `.text' of module_tree_communicator.o (symbol from plugin)
LDFLAGS += -u walk_worker_thread -u run_communication_loop
FFLAGS += -u walk_worker_thread -u run_communication_loop


ifeq ($(OMP), 1)
  FFLAGS   += -fopenmp
  LDFLAGS  += -fopenmp 
else
endif

FCPRE    = 
FC       = mpigfortran-4.9

CCPRE    = 
CC       = mpigcc-4.9

LDPRE    = 
LD       = mpigfortran-4.9
LDLIBS   = 

RM       = rm -rf


