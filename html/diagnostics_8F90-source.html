<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PEPC: diagnostics.F90 Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7-20060810 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_28272fc65e3d756317163f9acb2ad644.html">gibbon</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e3e416c1e3f7ebc92335d37fb0dd4777.html">pepc</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_991097dbe07e9883c0a11fa77543783e.html">pepc-b</a></div>
<h1>diagnostics.F90</h1><a href="diagnostics_8F90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 !  ================================
<a name="l00002"></a>00002 !
<a name="l00003"></a>00003 !         DIAGNOSTICS
<a name="l00004"></a>00004 !
<a name="l00005"></a>00005 !     Perform <a class="code" href="diagnostics_8F90.html#b86e86523f3c0812112f5b2f447432b1">diagnostics</a>
<a name="l00006"></a>00006 !
<a name="l00007"></a>00007 !
<a name="l00008"></a>00008 !  ================================
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="diagnostics_8F90.html#b86e86523f3c0812112f5b2f447432b1">00011</a> subroutine <a class="code" href="diagnostics_8F90.html#b86e86523f3c0812112f5b2f447432b1">diagnostics</a>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013   use treevars
<a name="l00014"></a>00014   use physvars
<a name="l00015"></a>00015   implicit none
<a name="l00016"></a>00016   include 'mpif.h'
<a name="l00017"></a>00017 
<a name="l00018"></a>00018   integer :: i,<a class="code" href="namespacepepcb.html#d94b9000718e7d94a84804d2856bb7b6">lvisit_active</a>, <a class="code" href="namespacepepcb.html#983db3cf9f618b2f0150d9907a4bc743">ifile</a>, <a class="code" href="namespacepepcb.html#a0d18ab20b16a2f6f7ea2d6b62caab43">ierr</a>
<a name="l00019"></a>00019   integer :: max_nnodes, max_fetches, max_reqs, max_sum_fetches, max_sum_ships,max_local_f, max_local_r, sum_local_f
<a name="l00020"></a>00020   integer :: vcount=0
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 ! Tree <a class="code" href="diagnostics_8F90.html#b86e86523f3c0812112f5b2f447432b1">diagnostics</a>
<a name="l00023"></a>00023 ! If interaction lists needed, must ensure that <a class="code" href="namespacetreevars.html#f99b61fd87d2273b634f6cb97c1f920c">intlist</a>() is large enough to contain all lists
<a name="l00024"></a>00024 ! - will otherwise just get last pass of tree walk
<a name="l00025"></a>00025 
<a name="l00026"></a>00026   if ( <a class="code" href="namespacetreevars.html#917587657ac434132020e7adaeb8b1f3">dump_tree</a> .and. mod(<a class="code" href="namespacephysvars.html#c125a4e0d163ae9c82706249ee8ddee4">itime</a>,<a class="code" href="namelist_8h.html#e3f41688c55ecf61f14ee189d036a104">iprot</a>) ==0 ) then
<a name="l00027"></a>00027      call <a class="code" href="diagnose__tree_8f90.html#0ebc533aa04abc5a0548c36ec62b2cff">diagnose_tree</a>   ! Printed tree info (<a class="code" href="namespacetreevars.html#f3784041f7cce271ebb213e4e88fb0a0">htable</a> etc)
<a name="l00028"></a>00028      call <a class="code" href="draw__tree2d_8f90.html#e462622899e8706b0d20e5b6b14304cb">draw_tree2d</a>(<a class="code" href="namelist_8h.html#b8c12579d5380e3cd3777e1c2a43d242">xl</a>,<a class="code" href="namelist_8h.html#920848accbcb0bcb52d1d0d8c31eda24">yl</a>)     ! Draw PE-trees
<a name="l00029"></a>00029      call <a class="code" href="draw__lists_8f90.html#0d0f4733ee7960da40d7148ea4de6c5c">draw_lists</a>      ! Draw interaction lists
<a name="l00030"></a>00030      call <a class="code" href="draw__domains_8f90.html#58dc232b5b34e9d0fb32b09c6a723dcb">draw_domains</a>(itime+<a class="code" href="namespacephysvars.html#35b069b237be060c93579f29eb66a91d">itime_start</a>)   ! Domains
<a name="l00031"></a>00031   endif
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034   ! Interface to VISIT (Online visualisation)
<a name="l00035"></a>00035 
<a name="l00036"></a>00036   if (<a class="code" href="namelist_8h.html#a247e30b819e3cee3af3906a79c2f020">u_beam</a>&gt;0 .and. <a class="code" href="namespacephysvars.html#1ff60eac6a083e1ac61c674793e352cc">beam_config</a>==3) <a class="code" href="namelist_8h.html#0650627b79fc23e2652232fe09854e4f">scheme</a>=1  ! Switch off Te control if <a class="code" href="beam_8f90.html#237ea3870e5d133929260457ba33d476">beam</a> on
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#ifdef VISIT_NBODY</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>  <span class="keywordflow">if</span> ( <a class="code" href="namelist_8h.html#b5f956c45a8c46f5cc04782bfe292bfb">vis_on</a> ) then
<a name="l00040"></a>00040      !     <span class="keywordflow">if</span> ( mod(itime,<a class="code" href="namelist_8h.html#d5ec89e6645ccc882472b2adeb02762e">ivis</a>) ==0 ) call <a class="code" href="vis__parts_8f90.html#e2a23f44bbc93be4f1f88a28c93fabc1">vis_parts</a>       
<a name="l00041"></a>00041      <span class="keywordflow">if</span> ( mod(itime,<a class="code" href="namelist_8h.html#d5ec89e6645ccc882472b2adeb02762e">ivis</a>) ==0 ) then
<a name="l00042"></a>00042         call <a class="code" href="vis__parts__nbody_8F90.html#40b492447e8b4d9eecd8e92773223fc9">vis_parts_nbody</a>(vcount)
<a name="l00043"></a>00043         vcount = vcount + 1
<a name="l00044"></a>00044      endif
<a name="l00045"></a>00045      if ( mod(itime,min(<a class="code" href="namelist_8h.html#d5ec89e6645ccc882472b2adeb02762e">ivis</a>,<a class="code" href="namelist_8h.html#4718be316f318cf31265b66708828a0a">ivis_fields</a>))==0 .and. <a class="code" href="namelist_8h.html#7d210c4b8644049edb9d3d698b69d6b2">steering</a>) call <a class="code" href="vis__control_8F90.html#343680df11b47609966af69d6b22cf14">vis_control</a>
<a name="l00046"></a>00046      if ( mod(itime,<a class="code" href="namelist_8h.html#4718be316f318cf31265b66708828a0a">ivis_fields</a>)==0 ) then
<a name="l00047"></a>00047         !     call <a class="code" href="pot__grid_8f90.html#7a6a221d7a61550579c9483041b0f1a2">pot_grid</a>
<a name="l00048"></a>00048         call <a class="code" href="densities_8f90.html#fe18e7ef5e3478334cacda1d55bd4133">densities</a>
<a name="l00049"></a>00049         call <a class="code" href="sum__fields_8f90.html#529fab4506148317de1e6937d0d11c38">sum_fields</a>
<a name="l00050"></a>00050         call <a class="code" href="vis__fields__nbody_8F90.html#b47dc6f9ae95f330275c117627b0b4fd">vis_fields_nbody</a>(itime+<a class="code" href="namespacephysvars.html#35b069b237be060c93579f29eb66a91d">itime_start</a>)
<a name="l00051"></a>00051         call <a class="code" href="vis__vecfields__nbody_8F90.html#5ade176b2f6444bf16c0832543a0d4e8">vis_vecfields_nbody</a>(itime+<a class="code" href="namespacephysvars.html#35b069b237be060c93579f29eb66a91d">itime_start</a>)
<a name="l00052"></a>00052      endif
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   endif
<a name="l00055"></a>00055 <span class="preprocessor">#endif</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>  !  <span class="keywordflow">if</span> (<a class="code" href="namelist_8h.html#65b106175d5c7acd554c1bce2595f2a8">target_geometry</a>.eq.4) then
<a name="l00057"></a>00057   !    <span class="keywordflow">do</span> i=1,<a class="code" href="namespacetreevars.html#46a9849e874a74f8747a37e0c76910c7">npp</a>
<a name="l00058"></a>00058   !     <span class="keywordflow">if</span> (<a class="code" href="namespacetreevars.html#745c67b70193cf25d51284647d7731d6">pelabel</a>(i)==60) then
<a name="l00059"></a>00059   !     <span class="keywordflow">if</span> (itime.eq.0) write(90,'(a)') '! t <a class="code" href="namespacetreevars.html#466130ce7b2fb1b56c99a0524b270b70">x</a> <a class="code" href="namespacetreevars.html#4b80abeb37dca0426ceec7dd7e914454">ux</a> <a class="code" href="namespacetreevars.html#965b464677536c91c1aa7d309b77487f">Ex</a> <a class="code" href="namespacetreevars.html#f8fc5bb4d3d3cf05020bdb2d2e095ad8">Ax</a> <a class="code" href="namespacetreevars.html#23ddfaf21eda623491dd23e0b5c6c2ee">Axo</a> -dA/<a class="code" href="namelist_8h.html#a3753cec73bb5fd57684e7692a606f05">dt</a> <a class="code" href="namespacetreevars.html#e97659a717b3512a29ee1233e020d171">Bx</a>' 
<a name="l00060"></a>00060   !       write (90,'(8(1pe15.4))') itime*<a class="code" href="namelist_8h.html#a3753cec73bb5fd57684e7692a606f05">dt</a>,<a class="code" href="namespacetreevars.html#466130ce7b2fb1b56c99a0524b270b70">x</a>(i),<a class="code" href="namespacetreevars.html#4b80abeb37dca0426ceec7dd7e914454">ux</a>(i),<a class="code" href="namespacetreevars.html#965b464677536c91c1aa7d309b77487f">Ex</a>(i),<a class="code" href="namespacetreevars.html#f8fc5bb4d3d3cf05020bdb2d2e095ad8">Ax</a>(i),<a class="code" href="namespacetreevars.html#23ddfaf21eda623491dd23e0b5c6c2ee">Axo</a>(i),(<a class="code" href="namespacetreevars.html#23ddfaf21eda623491dd23e0b5c6c2ee">Axo</a>(i)-<a class="code" href="namespacetreevars.html#f8fc5bb4d3d3cf05020bdb2d2e095ad8">Ax</a>(i))/dt,<a class="code" href="namespacetreevars.html#e97659a717b3512a29ee1233e020d171">Bx</a>(i)
<a name="l00061"></a>00061   !     endif
<a name="l00062"></a>00062   !    enddo
<a name="l00063"></a>00063   !  endif
<a name="l00064"></a>00064 
<a name="l00065"></a>00065   if (mod(itime,<a class="code" href="namelist_8h.html#ec85c3dcd7fbe98f6846756ca7f020d1">idump</a>) &gt;= <a class="code" href="namelist_8h.html#ec85c3dcd7fbe98f6846756ca7f020d1">idump</a>-<a class="code" href="namespacephysvars.html#db436c8a6e44b2ffb9293000d2bd8a98">navcycle</a>) call <a class="code" href="sum__fields_8f90.html#529fab4506148317de1e6937d0d11c38">sum_fields</a>    ! Accumulate cycle-averaged fields on grid
<a name="l00066"></a>00066   !  - assume for now that <a class="code" href="namelist_8h.html#ec85c3dcd7fbe98f6846756ca7f020d1">idump</a> &gt; <a class="code" href="namespacephysvars.html#db436c8a6e44b2ffb9293000d2bd8a98">navcycle</a>
<a name="l00067"></a>00067   !  - should really use running average to be compatible with online vis.
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 
<a name="l00070"></a>00070   if (<a class="code" href="namespacephysvars.html#1ff60eac6a083e1ac61c674793e352cc">beam_config</a> == 4 .and. mod(itime,<a class="code" href="namelist_8h.html#84995ea140e422b957f7f6749431ebdf">itrack</a>)==0 ) call <a class="code" href="track__nc_8f90.html#c182065ab0e9d46842c19a7c6beda71e">track_nc</a>          ! Gather <a class="code" href="densities_8f90.html#fe18e7ef5e3478334cacda1d55bd4133">densities</a> and track critical surface 
<a name="l00071"></a>00071   if( mod(itime+<a class="code" href="namespacephysvars.html#35b069b237be060c93579f29eb66a91d">itime_start</a>,<a class="code" href="namelist_8h.html#4718be316f318cf31265b66708828a0a">ivis_fields</a>)==0 .and. <a class="code" href="namelist_8h.html#65b106175d5c7acd554c1bce2595f2a8">target_geometry</a>==1) then
<a name="l00072"></a>00072      call <a class="code" href="sum__radial_8f90.html#de1c4c7c7fefa360c8bdf7a5ba8f827f">sum_radial</a>(itime+itime_start)  ! Radial moments
<a name="l00073"></a>00073   endif
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   if (itime_start&gt;0 .and. itime==0) return  ! Avoid over-writing <a class="code" href="namelist_8h.html#2bdedf3cae2a62acd8af28e53daed9c0">restart</a> data
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   call <a class="code" href="energy__cons_8f90.html#72f713ce0f29d9c7b70114f69ac67e20">energy_cons</a>(<a class="code" href="namespacephysvars.html#2284b49b27b32bb29f9678899991bee5">Ukine</a>,<a class="code" href="namespacephysvars.html#5608c96d891ce098b329ed9774ff42fa">Ukini</a>,<a class="code" href="namespacephysvars.html#7e34e5b8abe3eea3119bdda60436d387">Umagnetic</a>,<a class="code" href="namespacephysvars.html#ddc09144027fe7ecdf5d861885faecbb">Ubeam</a>)       ! Compute energy <a class="code" href="namelist_8h.html#2606f6bb46feacaea3f8c92db8f66a9c">balance</a>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   if ( <a class="code" href="namelist_8h.html#ec85c3dcd7fbe98f6846756ca7f020d1">idump</a>&gt;0 .and. (mod(itime+itime_start,<a class="code" href="namelist_8h.html#ec85c3dcd7fbe98f6846756ca7f020d1">idump</a>)==0 .or. itime==<a class="code" href="namelist_8h.html#58180e8c0d5861401d042d1238c294a3">nt</a>) ) then
<a name="l00082"></a>00082      call <a class="code" href="dump_8f90.html#88b597631f796e2b06c577e64bd94fe9">dump</a>(itime+itime_start)     ! Dump complete set of particle data
<a name="l00083"></a>00083      call <a class="code" href="dump__fields_8f90.html#8d65add174683bd57a9d4238f1abbcd1">dump_fields</a>(itime+itime_start)  ! Field data
<a name="l00084"></a>00084   endif
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 !  if (<a class="code" href="namelist_8h.html#79d8c3e2761fc8654683dc3f97e58e25">debug_level</a>.ge.2) then
<a name="l00088"></a>00088      sum_local_f =  sum(<a class="code" href="namespacetreevars.html#57da86873a8ef7e030a571b7ad0263f0">nfetch_total</a>)  
<a name="l00089"></a>00089      call MPI_ALLREDUCE(<a class="code" href="namespacetreevars.html#959a7ea5cb1126405dfbdbccfe52579c">sum_fetches</a>, max_sum_fetches, 1, MPI_INTEGER, MPI_MAX, MPI_COMM_WORLD, <a class="code" href="namespacepepcb.html#a0d18ab20b16a2f6f7ea2d6b62caab43">ierr</a> )  
<a name="l00090"></a>00090      call MPI_ALLREDUCE(<a class="code" href="namespacetreevars.html#98a5e67d24ae4f0fe88492d6cf4f77a9">sum_ships</a>, max_sum_ships, 1, MPI_INTEGER, MPI_MAX, MPI_COMM_WORLD, <a class="code" href="namespacepepcb.html#a0d18ab20b16a2f6f7ea2d6b62caab43">ierr</a> )  
<a name="l00091"></a>00091      call MPI_ALLREDUCE(sum_local_f, max_fetches, 1, MPI_INTEGER, MPI_MAX, MPI_COMM_WORLD, <a class="code" href="namespacepepcb.html#a0d18ab20b16a2f6f7ea2d6b62caab43">ierr</a> )  
<a name="l00092"></a>00092   <a class="code" href="namespacetreevars.html#a1eb75b89eb026fdd25ce002fc580fc9">nnodes</a>=<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>+<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>
<a name="l00093"></a>00093   call MPI_ALLREDUCE(<a class="code" href="namespacetreevars.html#a1eb75b89eb026fdd25ce002fc580fc9">nnodes</a>, max_nnodes, 1, MPI_INTEGER, MPI_MAX, MPI_COMM_WORLD, <a class="code" href="namespacepepcb.html#a0d18ab20b16a2f6f7ea2d6b62caab43">ierr</a> )  
<a name="l00094"></a>00094 ! max_reqs, max_fetches should be equal
<a name="l00095"></a>00095 !  endif
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   if (<a class="code" href="namespacephysvars.html#0decf2aea2fce458b260b471e6478e55">my_rank</a>.eq.<a class="code" href="namelist_8h.html#151437c5fb81b942d71aaa08eaad348b">debug_rank</a> .and. <a class="code" href="namelist_8h.html#436e327bca487d548233351dc851c2ba">debug_tree</a> &gt; 0) then
<a name="l00098"></a>00098 
<a name="l00099"></a>00099      do <a class="code" href="namespacepepcb.html#983db3cf9f618b2f0150d9907a4bc743">ifile</a> = 6,15,9
<a name="l00100"></a>00100         write(ifile,'(/a,i4)') 'Tree stats for CPU ',<a class="code" href="namelist_8h.html#151437c5fb81b942d71aaa08eaad348b">debug_rank</a>
<a name="l00101"></a>00101         write(ifile,'(a50,2i10,a3,i8)') 'new <a class="code" href="namespacetreevars.html#46a9849e874a74f8747a37e0c76910c7">npp</a>, <a class="code" href="namespacetreevars.html#ac21a2dc42e5595e66cba603534873bd">npart</a>, (max): ',npp,npart,'/',<a class="code" href="namespacetreevars.html#9e75bc118eec193572c6977e290cc74e">nppm</a>
<a name="l00102"></a>00102         write(ifile,'(a50,3i8)') 'local <span class="preprocessor"># leaves, twigs, keys: ',nleaf_me,ntwig_me,nleaf_me+ntwig_me</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>        write(ifile,'(a50,3i8)') 'non-local # leaves, twigs, keys: ',<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>-<a class="code" href="namespacetreevars.html#9d0ea8878e6790262000ba4d92324583">nleaf_me</a>,<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>-<a class="code" href="namespacetreevars.html#7e3153d8a8b22c2802f4b3c054e10fd2">ntwig_me</a>,<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>+<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>-nleaf_me-ntwig_me
<a name="l00104"></a>00104         write(ifile,'(a50,3i8,f12.1,a6,i8)') '<span class="keyword">final</span> # leaves, twigs, keys, (max): ',<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>,<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>,<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>+<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>, &amp;
<a name="l00105"></a>00105              (<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>+<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>)/(.01*<a class="code" href="namespacetreevars.html#88ddb99cee17ffd203ed6e3adbdebaa5">maxaddress</a>),' % of ',<a class="code" href="namespacetreevars.html#88ddb99cee17ffd203ed6e3adbdebaa5">maxaddress</a>
<a name="l00106"></a>00106         write(ifile,'(a50,i8,f12.1,a6,i8)') 'max # leaves+twigs: ',max_nnodes, &amp;
<a name="l00107"></a>00107              max_nnodes/(.01*<a class="code" href="namespacetreevars.html#88ddb99cee17ffd203ed6e3adbdebaa5">maxaddress</a>),' % of ',<a class="code" href="namespacetreevars.html#88ddb99cee17ffd203ed6e3adbdebaa5">maxaddress</a>
<a name="l00108"></a>00108         write(ifile,'(a50,2i8,a3,i7)') 'local, global # branches, (max): ',<a class="code" href="namespacetreevars.html#1f1e66a4a2d8a1c31ce68e97ff49b7db">nbranch</a>,<a class="code" href="namespacetreevars.html#47708bdfab837f3fc4ea54b8c8f99a50">nbranch_sum</a>,<span class="charliteral">'/'</span>,<a class="code" href="namespacetreevars.html#2ab032311413ab109ee55aa6ee9a83ab">nbranch_max</a>
<a name="l00109"></a>00109         write (ifile,'(a50,i8,a3,i7)') 'Max length of all interaction lists: ',<a class="code" href="namespacetreevars.html#eedff4d85b564024fa75dda1a3aceb78">max_list_length</a>,' / ',<a class="code" href="namespacetreevars.html#4f04c8bb799d1a68b883e63b3746012d">nintmax</a>
<a name="l00110"></a>00110         write (ifile,'(a50,i8)') 'Max # traversals ',<a class="code" href="namespacetreevars.html#66a1faa6be6c372bb5a156d17381b892">maxtraverse</a>
<a name="l00111"></a>00111 
<a name="l00112"></a>00112         write (ifile,'(a50,i8)') 'Max # multipole fetches/cpu/walk ',max_fetches-<a class="code" href="namespacetreevars.html#452b042822b98ddede3a99dac2db3ef1">max_prefetches</a>
<a name="l00113"></a>00113         write (ifile,'(a50,i8)') 'Max # multipole prefetches/cpu/<a class="code" href="namespacetreevars.html#268e054a2a11dd7806061233237fef15">prefetch</a> ',<a class="code" href="namespacetreevars.html#452b042822b98ddede3a99dac2db3ef1">max_prefetches</a>
<a name="l00114"></a>00114         write (ifile,'(a50,2i8)') 'Local #  multipole fetches &amp; ships/iteration ',sum_fetches,sum_ships
<a name="l00115"></a>00115         <span class="keywordflow">if</span> (<a class="code" href="namelist_8h.html#436e327bca487d548233351dc851c2ba">debug_tree</a>.ge.3) write (ifile,*) ' cumulative # requested keys:  ',<a class="code" href="namespacetreevars.html#c56353fcc7cc41b4f1f42d0a50cc4d64">nreqs_total</a>
<a name="l00116"></a>00116         <span class="keywordflow">if</span> (<a class="code" href="namelist_8h.html#436e327bca487d548233351dc851c2ba">debug_tree</a>.ge.3) write (ifile,*) ' cumulative # fetched keys:    ',<a class="code" href="namespacetreevars.html#57da86873a8ef7e030a571b7ad0263f0">nfetch_total</a>
<a name="l00117"></a>00117         write (ifile,'(a50,i8,a3,i7)') 'Max # multipole fetches/cpu/iteration / limit',max_sum_fetches,<span class="charliteral">'/'</span>,<a class="code" href="namespacetreevars.html#e34bba8fd21d4150370b72505a8b8ab7">size_fetch</a>
<a name="l00118"></a>00118         write (ifile,'(a50,i8,a3,i7)') 'Max # multipole ships/cpu/iteration / limit',max_sum_ships,<span class="charliteral">'/'</span>,<a class="code" href="namespacetreevars.html#e34bba8fd21d4150370b72505a8b8ab7">size_fetch</a>
<a name="l00119"></a>00119         write (ifile,'(a50,3f12.3)') 'Load imbalance percent,min,max: ',<a class="code" href="namespacetreevars.html#5254afbd41f37f9199feb0ef874da549">work_imbal</a>,<a class="code" href="namespacetreevars.html#d77dd3f319d1220bdae713de6ee6e9a9">work_imbal_min</a>,<a class="code" href="namespacetreevars.html#5e9d6d6bc5fa5b4ba685e8d09ddfdb21">work_imbal_max</a>
<a name="l00120"></a>00120         write (ifile,'(a50,f15.3,2i15)') 'Particle imbalance ave,min,max: ',<a class="code" href="namespacetreevars.html#1c6f6ce6c7237fbdefef8c4744d82536">part_imbal</a>,<a class="code" href="namespacetreevars.html#a5ac7398debd6e725cb5c598634c9847">part_imbal_min</a>,<a class="code" href="namespacetreevars.html#037f0ca40826a460afc88f31014fde6d">part_imbal_max</a>
<a name="l00121"></a>00121      end <span class="keywordflow">do</span>
<a name="l00122"></a>00122   endif
<a name="l00123"></a>00123 
<a name="l00124"></a>00124   <span class="keywordflow">if</span> (<a class="code" href="namespacetreevars.html#1c6f6ce6c7237fbdefef8c4744d82536">part_imbal</a>&gt;5 .or. work_imbal_min &lt; 0.1) then
<a name="l00125"></a>00125    <span class="keywordflow">if</span> (<a class="code" href="namespacephysvars.html#0decf2aea2fce458b260b471e6478e55">my_rank</a>.eq.debug_rank) write(ifile,'(a)') 'WARNING: Load imbalance too large - switching to debug mode'
<a name="l00126"></a>00126    <a class="code" href="namelist_8h.html#436e327bca487d548233351dc851c2ba">debug_tree</a> = 2
<a name="l00127"></a>00127   endif
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 ! Array bound check
<a name="l00130"></a>00130   <span class="keywordflow">if</span> (<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>+<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a> &gt; .95*<a class="code" href="namespacetreevars.html#88ddb99cee17ffd203ed6e3adbdebaa5">maxaddress</a>) then
<a name="l00131"></a>00131      write (6,'(a,i4)') '*** WARNING:  hash table &gt;95% full on CPU ',<a class="code" href="namespacephysvars.html#0decf2aea2fce458b260b471e6478e55">my_rank</a> 
<a name="l00132"></a>00132 
<a name="l00133"></a>00133      <span class="keywordflow">do</span> ifile = 6,15,9
<a name="l00134"></a>00134         write(ifile,'(/a,i4)') 'Tree stats <span class="keywordflow">for</span> CPU ',<a class="code" href="namespacephysvars.html#0decf2aea2fce458b260b471e6478e55">my_rank</a>
<a name="l00135"></a>00135         write(ifile,'(a50,2i10,a3,i8)') '<span class="keyword">new</span> npp, npart, (max): ',npp,npart,<span class="charliteral">'/'</span>,<a class="code" href="namespacetreevars.html#9e75bc118eec193572c6977e290cc74e">nppm</a>
<a name="l00136"></a>00136         write(ifile,'(a50,3i8)') 'local # leaves, twigs, keys: ',nleaf_me,ntwig_me,nleaf_me+ntwig_me
<a name="l00137"></a>00137         write(ifile,'(a50,3i8)') 'non-local # leaves, twigs, keys: ',<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>-nleaf_me,<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>-ntwig_me,<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>+<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>-nleaf_me-ntwig_me
<a name="l00138"></a>00138         write(ifile,'(a50,3i8,f12.1,a6,i8)') '<span class="keyword">final</span> # leaves, twigs, keys, (max): ',<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>,<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>,<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>+<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>, &amp;
<a name="l00139"></a>00139              (<a class="code" href="namespacetreevars.html#fb6610fee5c52c51b8f7cc46ce975c16">nleaf</a>+<a class="code" href="namespacetreevars.html#863a5294e9f064d8de564660bd1cf82d">ntwig</a>)/(.01*<a class="code" href="namespacetreevars.html#88ddb99cee17ffd203ed6e3adbdebaa5">maxaddress</a>),' % of ',<a class="code" href="namespacetreevars.html#88ddb99cee17ffd203ed6e3adbdebaa5">maxaddress</a>
<a name="l00140"></a>00140         write(ifile,'(a50,i8,f12.1,a6,i8)') 'max # leaves+twigs: ',max_nnodes, &amp;
<a name="l00141"></a>00141              max_nnodes/(.01*<a class="code" href="namespacetreevars.html#88ddb99cee17ffd203ed6e3adbdebaa5">maxaddress</a>),' % of ',<a class="code" href="namespacetreevars.html#88ddb99cee17ffd203ed6e3adbdebaa5">maxaddress</a>
<a name="l00142"></a>00142         write(ifile,'(a50,2i8,a3,i7)') 'local, global # branches, (max): ',<a class="code" href="namespacetreevars.html#1f1e66a4a2d8a1c31ce68e97ff49b7db">nbranch</a>,<a class="code" href="namespacetreevars.html#47708bdfab837f3fc4ea54b8c8f99a50">nbranch_sum</a>,<span class="charliteral">'/'</span>,<a class="code" href="namespacetreevars.html#2ab032311413ab109ee55aa6ee9a83ab">nbranch_max</a>
<a name="l00143"></a>00143         write (ifile,'(a50,i8,a3,i7)') 'Max length of all interaction lists: ',<a class="code" href="namespacetreevars.html#eedff4d85b564024fa75dda1a3aceb78">max_list_length</a>,' / ',<a class="code" href="namespacetreevars.html#4f04c8bb799d1a68b883e63b3746012d">nintmax</a>
<a name="l00144"></a>00144         write (ifile,'(a50,i8)') 'Max # traversals ',<a class="code" href="namespacetreevars.html#66a1faa6be6c372bb5a156d17381b892">maxtraverse</a>
<a name="l00145"></a>00145 
<a name="l00146"></a>00146         write (ifile,'(a50,i8)') 'Max # multipole fetches/cpu/walk ',max_fetches-<a class="code" href="namespacetreevars.html#452b042822b98ddede3a99dac2db3ef1">max_prefetches</a>
<a name="l00147"></a>00147         write (ifile,'(a50,i8)') 'Max # multipole prefetches/cpu/<a class="code" href="namespacetreevars.html#268e054a2a11dd7806061233237fef15">prefetch</a> ',<a class="code" href="namespacetreevars.html#452b042822b98ddede3a99dac2db3ef1">max_prefetches</a>
<a name="l00148"></a>00148         write (ifile,'(a50,2i8)') 'Local #  multipole fetches &amp; ships/iteration ',sum_fetches,sum_ships
<a name="l00149"></a>00149         <span class="keywordflow">if</span> (debug_tree.ge.3) write (ifile,*) ' cumulative # requested keys:  ',<a class="code" href="namespacetreevars.html#c56353fcc7cc41b4f1f42d0a50cc4d64">nreqs_total</a>
<a name="l00150"></a>00150         <span class="keywordflow">if</span> (debug_tree.ge.3) write (ifile,*) ' cumulative # fetched keys:    ',<a class="code" href="namespacetreevars.html#57da86873a8ef7e030a571b7ad0263f0">nfetch_total</a>
<a name="l00151"></a>00151         write (ifile,'(a50,i8,a3,i7)') 'Max # multipole fetches/cpu/iteration / limit',max_sum_fetches,<span class="charliteral">'/'</span>,<a class="code" href="namespacetreevars.html#e34bba8fd21d4150370b72505a8b8ab7">size_fetch</a>
<a name="l00152"></a>00152         write (ifile,'(a50,i8,a3,i7)') 'Max # multipole ships/cpu/iteration / limit',max_sum_ships,<span class="charliteral">'/'</span>,<a class="code" href="namespacetreevars.html#e34bba8fd21d4150370b72505a8b8ab7">size_fetch</a>
<a name="l00153"></a>00153         write (ifile,'(a50,3f12.3)') 'Load imbalance percent,min,max: ',<a class="code" href="namespacetreevars.html#5254afbd41f37f9199feb0ef874da549">work_imbal</a>,work_imbal_min,<a class="code" href="namespacetreevars.html#5e9d6d6bc5fa5b4ba685e8d09ddfdb21">work_imbal_max</a>
<a name="l00154"></a>00154         write (ifile,'(a50,f15.3,2i15)') 'Particle imbalance ave,min,max: ',<a class="code" href="namespacetreevars.html#1c6f6ce6c7237fbdefef8c4744d82536">part_imbal</a>,part_imbal_min,<a class="code" href="namespacetreevars.html#037f0ca40826a460afc88f31014fde6d">part_imbal_max</a>
<a name="l00155"></a>00155      end <span class="keywordflow">do</span>
<a name="l00156"></a>00156   endif
<a name="l00157"></a>00157 
<a name="l00158"></a>00158   <span class="keywordflow">if</span> (max_nnodes &gt; .95*<a class="code" href="namespacetreevars.html#88ddb99cee17ffd203ed6e3adbdebaa5">maxaddress</a>) then
<a name="l00159"></a>00159      call <a class="code" href="abort_8f90.html#5800879dd9e6eea4e4db89294ccf4353">cleanup</a>
<a name="l00160"></a>00160   endif
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 !  <span class="keywordflow">if</span> (max_local_f &gt; .95*<a class="code" href="namespacetreevars.html#e34bba8fd21d4150370b72505a8b8ab7">size_fetch</a>) then
<a name="l00163"></a>00163 !     write (6,'(a,i4,a1,i8,a3,i8)') '*** WARNING:  # fetches &gt;95% max on CPU ',<a class="code" href="namespacephysvars.html#0decf2aea2fce458b260b471e6478e55">my_rank</a>,<span class="charliteral">':'</span>,max_local_f,<span class="charliteral">'/'</span>,<a class="code" href="namespacetreevars.html#e34bba8fd21d4150370b72505a8b8ab7">size_fetch</a> 
<a name="l00164"></a>00164 !     call <a class="code" href="abort_8f90.html#5800879dd9e6eea4e4db89294ccf4353">cleanup</a>
<a name="l00165"></a>00165 !  endif
<a name="l00166"></a>00166   <span class="keywordflow">if</span> (npp &gt; <a class="code" href="namespacetreevars.html#9e75bc118eec193572c6977e290cc74e">nppm</a>) then
<a name="l00167"></a>00167      write (6,'(a,i4)') '*** WARNING:  particle arrays full on CPU ',my_rank 
<a name="l00168"></a>00168      write (6,'(a,i4)') '*** WARNING:  npp, <a class="code" href="namespacetreevars.html#9e75bc118eec193572c6977e290cc74e">nppm</a>:',npp, <a class="code" href="namespacetreevars.html#9e75bc118eec193572c6977e290cc74e">nppm</a> 
<a name="l00169"></a>00169      call MPI_ABORT(MPI_COMM_WORLD,<a class="code" href="namespacepepcb.html#a0d18ab20b16a2f6f7ea2d6b62caab43">ierr</a>)
<a name="l00170"></a>00170      stop 
<a name="l00171"></a>00171   endif
<a name="l00172"></a>00172 end subroutine <a class="code" href="diagnostics_8F90.html#b86e86523f3c0812112f5b2f447432b1">diagnostics</a>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jan 23 16:02:49 2007 for PEPC by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7-20060810 </small></address>
</body>
</html>
