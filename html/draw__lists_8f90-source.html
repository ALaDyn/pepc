<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PEPC: draw_lists.f90 Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7-20060810 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_28272fc65e3d756317163f9acb2ad644.html">gibbon</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e3e416c1e3f7ebc92335d37fb0dd4777.html">pepc</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_445afc100a243ec0eaed19e4a2dc673c.html">lpepcsrc</a></div>
<h1>draw_lists.f90</h1><a href="draw__lists_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 ! ======================
<a name="l00003"></a>00003 !
<a name="l00004"></a>00004 !   DRAW_LISTS
<a name="l00005"></a>00005 !
<a name="l00006"></a>00006 !   Draw selected particle lists
<a name="l00007"></a>00007 !
<a name="l00008"></a>00008 ! ======================
<a name="l00009"></a>00009 
<a name="l00010"></a><a class="code" href="draw__lists_8f90.html#0d0f4733ee7960da40d7148ea4de6c5c">00010</a> subroutine <a class="code" href="draw__lists_8f90.html#0d0f4733ee7960da40d7148ea4de6c5c">draw_lists</a>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 
<a name="l00013"></a>00013   use treevars
<a name="l00014"></a>00014 
<a name="l00015"></a>00015   implicit none
<a name="l00016"></a>00016 
<a name="l00017"></a>00017   integer*8 :: key_list(<a class="code" href="namespacetreevars.html#9e75bc118eec193572c6977e290cc74e">nppm</a>)
<a name="l00018"></a>00018 
<a name="l00019"></a>00019   integer, dimension(<a class="code" href="namespacetreevars.html#9e75bc118eec193572c6977e290cc74e">nppm</a>) ::  addr_list, level_list, node_list, owner_list       ! list data
<a name="l00020"></a>00020 
<a name="l00021"></a>00021   character(15) :: cfile
<a name="l00022"></a>00022   character(1) :: csnap
<a name="l00023"></a>00023   character(3) :: cme,cip
<a name="l00024"></a>00024   character(7), parameter :: colors(0:9) = (/<span class="stringliteral">"orange "</span>, <span class="stringliteral">"cyan   "</span>, <span class="stringliteral">"magenta"</span>, <span class="stringliteral">"blue   "</span>, <span class="stringliteral">"green  "</span>, &amp;
<a name="l00025"></a>00025        <span class="stringliteral">"red    "</span>,<span class="stringliteral">"yellow "</span>,<span class="stringliteral">"grey20 "</span>,<span class="stringliteral">"violet "</span>,<span class="stringliteral">"brown  "</span>/) 
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 
<a name="l00028"></a>00028   integer :: i, ip, j, ilev, isnap, ix, iy, nbits
<a name="l00029"></a>00029   real :: s, xt, yt
<a name="l00030"></a>00030   logical :: write_keys=.false.
<a name="l00031"></a>00031   integer :: <a class="code" href="get__address_8f90.html#2809b00e2dcb999b654cac13b2ffb261">key2addr</a>        ! Mapping function to get hash table <a class="code" href="namespacetreevars.html#3ecc2e98e400f5751ae1758d72035e15">address</a> from key
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 !  do ip=1,<a class="code" href="namespacetreevars.html#46a9849e874a74f8747a37e0c76910c7">npp</a>,<a class="code" href="namespacetreevars.html#46a9849e874a74f8747a37e0c76910c7">npp</a>/2
<a name="l00035"></a>00035   ip=1
<a name="l00036"></a>00036   !  Header file 
<a name="l00037"></a>00037   cme = achar(<a class="code" href="namespacetreevars.html#f0c1ebe7c983f1b1061d88e367afc933">me</a>/100+48) <span class="comment">// achar(me/10+48) // achar(mod(me,10)+48)  ! Convert 3-digit PE number into character string</span>
<a name="l00038"></a>00038   cip = achar(ip/100+48) <span class="comment">// achar(ip/10+48) // achar(mod(ip,10)+48)  ! Convert 3-digit particle number into character string</span>
<a name="l00039"></a>00039   cfile=<span class="stringliteral">"list_"</span><span class="comment">//cme//cip//".gle"</span>
<a name="l00040"></a>00040   write (<a class="code" href="namespacetreevars.html#0d5a9df9963aed1fb9d6ac000ba861f1">ipefile</a>,'(a)') cfile
<a name="l00041"></a>00041  open(60,file=cfile)
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   !  initialise graphics filter
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 !  write (60,'(a,2(/a),2(/a,2f13.4))') &amp;
<a name="l00046"></a>00046 !       'size 18 18' &amp;
<a name="l00047"></a>00047 !       , 'set font rm' &amp;
<a name="l00048"></a>00048 !       , 'set lwidth 0.001 lstyle 1' &amp;
<a name="l00049"></a>00049 !       , '<a class="code" href="ncnbody_8c.html#7a01ebd91ec3a2b85435442f09c909e9">begin</a> scale ',15./<a class="code" href="namespacetreevars.html#8b7d0bfaafb4911e08470411d32719f7">boxsize</a>,15./<a class="code" href="namespacetreevars.html#8b7d0bfaafb4911e08470411d32719f7">boxsize</a> &amp;
<a name="l00050"></a>00050 !       , '<a class="code" href="ncnbody_8c.html#7a01ebd91ec3a2b85435442f09c909e9">begin</a> translate ',.01*<a class="code" href="namespacetreevars.html#8b7d0bfaafb4911e08470411d32719f7">boxsize</a>,.01*<a class="code" href="namelist_8h.html#920848accbcb0bcb52d1d0d8c31eda24">yl</a>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 !  write (60,'(a/a,2f13.4)') 'amove 0 0','box ',<a class="code" href="namespacetreevars.html#8b7d0bfaafb4911e08470411d32719f7">boxsize</a>,<a class="code" href="namelist_8h.html#920848accbcb0bcb52d1d0d8c31eda24">yl</a>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   write (60,'(a)') 'set color black hei .3'
<a name="l00056"></a>00056   write (60,'(a)')  'psize=0.4' 
<a name="l00057"></a>00057   write (60,'(a,2f13.4)') 'amove ',<a class="code" href="namespacetreevars.html#466130ce7b2fb1b56c99a0524b270b70">x</a>(ip),<a class="code" href="namespacetreevars.html#5ca0fa6d04b09531b6c4c55c545bde27">y</a>(ip)
<a name="l00058"></a>00058   write (60,'(a,f10.5,2a)') 'marker otimes '
<a name="l00059"></a>00059   write (60,'(a,2f13.4)') 'rmove ',.1,.1
<a name="l00060"></a>00060 
<a name="l00061"></a>00061   write (60,'(a,i6)') 'text ',<a class="code" href="namespacetreevars.html#745c67b70193cf25d51284647d7731d6">pelabel</a>(ip)         ! write out label
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   !  Now do selected particle lists
<a name="l00065"></a>00065 
<a name="l00066"></a>00066   <a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a> = <a class="code" href="namespacetreevars.html#0c00c9ba3fcb9b5b155b47f4a1df1011">nterm</a>(ip)
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   ! get keys of twig nodes from hash table
<a name="l00069"></a>00069   key_list(1:<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>) = <a class="code" href="namespacetreevars.html#f99b61fd87d2273b634f6cb97c1f920c">intlist</a>(1:<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>,ip)
<a name="l00070"></a>00070   addr_list(1:<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>) = (/ ( <a class="code" href="get__address_8f90.html#2809b00e2dcb999b654cac13b2ffb261">key2addr</a>( key_list(i),'DRAW_LISTS' ),i=1,<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>) /)   !  Table <a class="code" href="namespacetreevars.html#3ecc2e98e400f5751ae1758d72035e15">address</a>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   ! get levels of twigs
<a name="l00073"></a>00073   level_list(1:<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>) = log( 1.*key_list(1:<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>) )/log(8.)
<a name="l00074"></a>00074   node_list(1:<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>) =   <a class="code" href="namespacetreevars.html#f3784041f7cce271ebb213e4e88fb0a0">htable</a>( addr_list(1:<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>))%node   !  nodes
<a name="l00075"></a>00075   owner_list(1:<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>) =   <a class="code" href="namespacetreevars.html#f3784041f7cce271ebb213e4e88fb0a0">htable</a>( addr_list(1:<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>))%owner      ! owner
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   write (60,'(a)') 'set lwidth .01 hei .02'
<a name="l00079"></a>00079 
<a name="l00080"></a>00080   do j=1,<a class="code" href="namespacetreevars.html#0ab6b4bd7d72fb33ff1080972a6000ef">nlist</a>
<a name="l00081"></a>00081     write (60,'(a,a7)') 'set color ',colors( mod(owner_list(j),10) )
<a name="l00082"></a>00082      ! get box coords from keys
<a name="l00083"></a>00083      nbits = level_list(j)
<a name="l00084"></a>00084      ix = SUM( (/ (2**i*ibits( key_list(j),3*i,1 ), i=0,nbits-1) /) )
<a name="l00085"></a>00085      iy = SUM( (/ (2**i*ibits( key_list(j),3*i+1,1 ), i=0,nbits-1) /) )
<a name="l00086"></a>00086 
<a name="l00087"></a>00087      s = <a class="code" href="namespacetreevars.html#8b7d0bfaafb4911e08470411d32719f7">boxsize</a>/2**(level_list(j))          !  box length
<a name="l00088"></a>00088      xt=ix*s + <a class="code" href="namespacetreevars.html#2ec63c3b9cf68233a13c938d6db6a02d">xmin</a>
<a name="l00089"></a>00089      yt=iy*s + <a class="code" href="namespacetreevars.html#341f905fe7f315fa0c25845356344e6a">ymin</a>
<a name="l00090"></a>00090      write (60,'(a,2f13.4)') 'amove ',xt,yt
<a name="l00091"></a>00091      write (60,'(a,2f13.4)') 'box ',s,s
<a name="l00092"></a>00092 
<a name="l00093"></a>00093      write (60,'(a,2f13.4)') 'amove ',<a class="code" href="namespacetreevars.html#4d053c9047892373590cadde565e3987">xcoc</a>( node_list(j) ),<a class="code" href="namespacetreevars.html#12a758eeb25f419290c25611e464f6d5">ycoc</a>( node_list(j) )        ! Centre of <a class="code" href="namespacetreevars.html#c635f0d036ac28a9d50d9a34ce023562">charge</a> of twig node
<a name="l00094"></a>00094      write (60,'(a,f10.5,2a)') 'circle ',(<a class="code" href="namespacetreevars.html#833874545f1ee36b5e31b4dfa3dc11d3">abs_charge</a>( node_list(j)))**(.33), &amp;
<a name="l00095"></a>00095                 '*psize fill ',colors( mod(owner_list(j),10) )
<a name="l00096"></a>00096     ! write (60,'(a,f10.5,2a)') 'circle ',psize,' fill ',colors( mod(owner_list(j),10) )
<a name="l00097"></a>00097      !
<a name="l00098"></a>00098      write (60,'(a)') 'set color black'
<a name="l00099"></a>00099      write (60,'(a,2f13.4)') 'amove ',xt+s/2,yt+s/2
<a name="l00100"></a>00100      if (write_keys) write (60,'(a,i6)') 'text ',key_list(j)  ! write out key
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   end do
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 !  write (60,'(2(/a))') 'end scale ','end translate'
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   close(60)
<a name="l00107"></a>00107 ! end do
<a name="l00108"></a>00108 end subroutine <a class="code" href="draw__lists_8f90.html#0d0f4733ee7960da40d7148ea4de6c5c">draw_lists</a>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jan 23 16:02:49 2007 for PEPC by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7-20060810 </small></address>
</body>
</html>
