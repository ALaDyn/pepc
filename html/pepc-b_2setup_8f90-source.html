<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PEPC: setup.f90 Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7-20060810 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_28272fc65e3d756317163f9acb2ad644.html">gibbon</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e3e416c1e3f7ebc92335d37fb0dd4777.html">pepc</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_991097dbe07e9883c0a11fa77543783e.html">pepc-b</a></div>
<h1>pepc-b/setup.f90</h1><a href="pepc-b_2setup_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 !  ================================
<a name="l00002"></a>00002 !
<a name="l00003"></a>00003 !         SETUP
<a name="l00004"></a>00004 !
<a name="l00005"></a>00005 !   $Revision: 500 $
<a name="l00006"></a>00006 !
<a name="l00007"></a>00007 !     Initialise physics constants and 
<a name="l00008"></a>00008 !      simulation variables
<a name="l00009"></a>00009 !
<a name="l00010"></a>00010 !  ================================
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 
<a name="l00013"></a><a class="code" href="pepc-b_2setup_8f90.html#776bd71acb1bba84c11a03c6e27bd8a9">00013</a> subroutine <a class="code" href="pepc-b_2setup_8f90.html#776bd71acb1bba84c11a03c6e27bd8a9">setup</a>
<a name="l00014"></a>00014   use physvars
<a name="l00015"></a>00015   implicit none
<a name="l00016"></a>00016 
<a name="l00017"></a>00017   integer :: k, npb_pe, ne_rest, ni_rest
<a name="l00018"></a>00018 
<a name="l00019"></a>00019   include 'namelist.h' 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021   !  Default input set
<a name="l00022"></a>00022 
<a name="l00023"></a>00023   ! switches
<a name="l00024"></a>00024 
<a name="l00025"></a>00025   <a class="code" href="namelist_8h.html#4fde60319c57c2a55f8226921ed5dd04">plasma_config</a> = 1  ! plasma target
<a name="l00026"></a>00026   <a class="code" href="namelist_8h.html#65b106175d5c7acd554c1bce2595f2a8">target_geometry</a> = 1         ! random sphere
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00029"></a>00029   ! particles
<a name="l00030"></a>00030   <a class="code" href="namelist_8h.html#7dec18d70ba492cad267471889b0dd6f">nep</a> = 0 ! # plasma electrons per PE
<a name="l00031"></a>00031   <a class="code" href="namelist_8h.html#6c4b21d213fef7eb3c21f8abc98104c6">nip</a> = 0
<a name="l00032"></a>00032   <a class="code" href="namelist_8h.html#c570850af67b707ee0fabd68903062f7">ne</a> = 100  ! Total # plasma electrons
<a name="l00033"></a>00033   <a class="code" href="namelist_8h.html#a4fb44be053c6d3f35c09963f7ac2ecc">ni</a> = 100  ! total # plasma ions
<a name="l00034"></a>00034   <a class="code" href="namelist_8h.html#235bab43c650353dffe09255dad91d2a">mc_steps</a> = 10
<a name="l00035"></a>00035 
<a name="l00036"></a>00036   <a class="code" href="namelist_8h.html#b8c12579d5380e3cd3777e1c2a43d242">xl</a> = 2
<a name="l00037"></a>00037   <a class="code" href="namelist_8h.html#920848accbcb0bcb52d1d0d8c31eda24">yl</a> = 2
<a name="l00038"></a>00038   <a class="code" href="namelist_8h.html#6fd88682b343fc37fa3c1e56f0c3a194">zl</a> = 2
<a name="l00039"></a>00039   
<a name="l00040"></a>00040   ! physics stuff
<a name="l00041"></a>00041   <a class="code" href="namelist_8h.html#59437d0609d7fe3a3500ed3e7ec47eb6">force_const</a> = 1./3.
<a name="l00042"></a>00042   <a class="code" href="namelist_8h.html#3f444f68368f046dc73b987aaeb74aef">bond_const</a> = 0.1
<a name="l00043"></a>00043   <a class="code" href="namelist_8h.html#b7fa4d53f0dfe33745ed74242277b1f4">rho0</a> = 1.0
<a name="l00044"></a>00044   <a class="code" href="namelist_8h.html#051ba9b635fca70611c05a5b65e92cd1">mac</a> = 0        ! Multipole acceptance criterion (BH by <span class="keywordflow">default</span>)
<a name="l00045"></a>00045   <a class="code" href="namelist_8h.html#2debd5e81fbe9e3985b18628f622d180">theta</a> = 0.5
<a name="l00046"></a>00046   <a class="code" href="namelist_8h.html#429f260c120e70994f1e7a588e8b776e">Te_keV</a> = 1.
<a name="l00047"></a>00047   <a class="code" href="namelist_8h.html#7e46f2d6cd8418ccadf739ef29b66748">Ti_keV</a> = <a class="code" href="namelist_8h.html#429f260c120e70994f1e7a588e8b776e">Te_keV</a>/10.
<a name="l00048"></a>00048   <a class="code" href="namelist_8h.html#f1bc0564918e4d8cf3163c91d73fec8f">mass_ratio</a> = 10.
<a name="l00049"></a>00049   <a class="code" href="namelist_8h.html#e20fb86f913bc05e1aa5bd022543b8a6">Zion</a> = 1.
<a name="l00050"></a>00050   <a class="code" href="namelist_8h.html#88197ea4882b64f8bf959e2323198a75">uthresh</a> = -1.
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <a class="code" href="namelist_8h.html#4717f1135bf0b6bb04e6105ceb5a08dd">r_sphere</a> = 0.5
<a name="l00053"></a>00053   <a class="code" href="namelist_8h.html#12ab60c2ad9358d336db6643fd3460ba">x_plasma</a> = 0.1    ! plasma disc thickness (2) or wire length (3)
<a name="l00054"></a>00054   <a class="code" href="namelist_8h.html#63c6deb40f1bc4b6f0fe258bb0961de3">y_plasma</a> = 1.     ! plasma width (slab target)
<a name="l00055"></a>00055   <a class="code" href="namelist_8h.html#28ed8643a1c9bcb04ff44c997115a182">z_plasma</a> = 1.     ! plasma width (slab target)
<a name="l00056"></a>00056   <a class="code" href="namelist_8h.html#3d5b0f2d79621403cfab74bce3469eb1">eps</a> = 0.1
<a name="l00057"></a>00057   <a class="code" href="namelist_8h.html#19a9d4e86f61066bf7fdfb4290c67a28">fnn</a> = 5  ! Neighbour search radius multiplier (<a class="code" href="namespacetreevars.html#466130ce7b2fb1b56c99a0524b270b70">x</a> <a class="code" href="namespacephysvars.html#12475503cd099fb76e2a93fab616f798">a_ii</a>)
<a name="l00058"></a>00058   <a class="code" href="namelist_8h.html#712155c80795c0d81c2164d3b568637a">delta_mc</a> = <a class="code" href="namelist_8h.html#4717f1135bf0b6bb04e6105ceb5a08dd">r_sphere</a>/5.
<a name="l00059"></a>00059   <a class="code" href="namelist_8h.html#22ace8f7f39e70394531379810914a19">displace</a>(1:3) = (/0.,0.,0./)
<a name="l00060"></a>00060   ! <a class="code" href="beam_8f90.html#237ea3870e5d133929260457ba33d476">beam</a>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062   !  <a class="code" href="namespacephysvars.html#1ff60eac6a083e1ac61c674793e352cc">beam_config</a> = 1  ! fixed <a class="code" href="beam_8f90.html#237ea3870e5d133929260457ba33d476">beam</a>, initialised at start
<a name="l00063"></a>00063   ! <a class="code" href="namespacephysvars.html#1ff60eac6a083e1ac61c674793e352cc">beam_config</a> = 2  ! user-controlled, real-time particle source
<a name="l00064"></a>00064   <a class="code" href="namelist_8h.html#9cd066e24ff6c31a0773858ce2a93967">beam_config_in</a> = 0 ! beam off
<a name="l00065"></a>00065   ! <a class="code" href="namespacephysvars.html#1ff60eac6a083e1ac61c674793e352cc">beam_config</a> = 4  ! <a class="code" href="laser_8f90.html#fb1137d97b183a5dd650ce11de600d8b">laser</a> ponderomotive force
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   <a class="code" href="namelist_8h.html#83d371d4a22e9ae035ef4b1832c420c0">r_beam</a> = 0.15
<a name="l00068"></a>00068   <a class="code" href="namelist_8h.html#a247e30b819e3cee3af3906a79c2f020">u_beam</a> = 0.2
<a name="l00069"></a>00069   <a class="code" href="namelist_8h.html#17a2c7e0225d20f086d24e3325833387">theta_beam</a> = 0.
<a name="l00070"></a>00070   <a class="code" href="namelist_8h.html#7c4f55f30c103162e80bb0b0cf91a6de">phi_beam</a> = 0.3
<a name="l00071"></a>00071   <a class="code" href="namelist_8h.html#962c375caffabfb36996c2ccf8bc6294">x_beam</a> = .04
<a name="l00072"></a>00072   <a class="code" href="namelist_8h.html#39259e1f1174d9c9f22e675cc0a87501">start_beam</a> = 0.4
<a name="l00073"></a>00073   <a class="code" href="namelist_8h.html#791729a79848f3bccfb1a1764f5c4b34">rho_beam</a> = -5.
<a name="l00074"></a>00074   <a class="code" href="namelist_8h.html#677611629bca3fb26f31ad89e71dd76e">mass_beam</a> = 3.
<a name="l00075"></a>00075   <a class="code" href="namelist_8h.html#deca65d6402d6c23fe9933bf421a948f">np_beam</a> = 0 ! initial <span class="preprocessor"># beam particles/ dt</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00077"></a>00077   ! <a class="code" href="laser_8f90.html#fb1137d97b183a5dd650ce11de600d8b">laser</a> stuff
<a name="l00078"></a>00078   <a class="code" href="namelist_8h.html#9b4649da6f2640c94a4a055ce84a75ac">sigma</a> = 1.
<a name="l00079"></a>00079   <a class="code" href="namelist_8h.html#bfa2c98ab379465701e70b7c1493368e">tpulse</a> = 10.
<a name="l00080"></a>00080   <a class="code" href="namelist_8h.html#0d0a3b5745c1c49963b9113d6a59b86a">vosc</a> = 0.1
<a name="l00081"></a>00081   <a class="code" href="namelist_8h.html#630bc314dbc10cc6306033525170d456">omega</a> = 0.5
<a name="l00082"></a>00082   <a class="code" href="namespacephysvars.html#1eda5c3f982f9a1d1b5a4344c9b2a361">theta_inc</a> = 0.
<a name="l00083"></a>00083   <a class="code" href="namelist_8h.html#491dc1def2e8c0c73a94027d0fb55365">x_offset</a> = 0.
<a name="l00084"></a>00084   <a class="code" href="namelist_8h.html#abea36853eff43f3696405cdbaad4c23">z_offset</a> = 0.
<a name="l00085"></a>00085   <a class="code" href="namespacephysvars.html#ce7ee718a38bd3f477f9ac537f245cdc">tlaser</a> = 0.    ! time since <a class="code" href="laser_8f90.html#fb1137d97b183a5dd650ce11de600d8b">laser</a> switched on
<a name="l00086"></a>00086   <a class="code" href="namelist_8h.html#e3d8df362ba9db761c5b2c3c47bd26f5">lambda</a> = 1.0
<a name="l00087"></a>00087   <a class="code" href="namespacephysvars.html#d600b15740f247daa8669e2ae53ddda2">rho_track</a> = 1.5
<a name="l00088"></a>00088   <a class="code" href="namelist_8h.html#661666f5d5cc4ce74f60547e50dec582">lolam</a> = 0.1
<a name="l00089"></a>00089   <a class="code" href="namelist_8h.html#ffb7499fada6ab3c26a7552906370475">rho_min</a> = 0.1
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   ! control
<a name="l00092"></a>00092   <a class="code" href="namelist_8h.html#58180e8c0d5861401d042d1238c294a3">nt</a> = 600
<a name="l00093"></a>00093   <a class="code" href="namelist_8h.html#a3753cec73bb5fd57684e7692a606f05">dt</a> = 0.2
<a name="l00094"></a>00094   <a class="code" href="namespacephysvars.html#f7fa5a2635732bfa872faaf10f901450">trun</a> = 0.
<a name="l00095"></a>00095   <a class="code" href="namelist_8h.html#d5ec89e6645ccc882472b2adeb02762e">ivis</a> = 1
<a name="l00096"></a>00096   <a class="code" href="namelist_8h.html#4718be316f318cf31265b66708828a0a">ivis_fields</a> = 1
<a name="l00097"></a>00097   <a class="code" href="namelist_8h.html#5a4ca04a8bd05443f47130b35c6f5e19">ivis_domains</a> = 1
<a name="l00098"></a>00098   <a class="code" href="namespacephysvars.html#35b069b237be060c93579f29eb66a91d">itime_start</a> = 0
<a name="l00099"></a>00099   <a class="code" href="namelist_8h.html#84995ea140e422b957f7f6749431ebdf">itrack</a> = 10
<a name="l00100"></a>00100   <a class="code" href="namelist_8h.html#9949864b603e886dd392b14122c3ac01">domain_cut</a> = <a class="code" href="namelist_8h.html#6fd88682b343fc37fa3c1e56f0c3a194">zl</a>
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   <a class="code" href="namelist_8h.html#273d3bff8b18ec89e78a20f7428c0d91">ngx</a> = 25   ! Grid size <span class="keywordflow">for</span> plots
<a name="l00103"></a>00103   <a class="code" href="namelist_8h.html#8882200f4d32762fb9a07ef67dcc9507">ngy</a> = 25
<a name="l00104"></a>00104   <a class="code" href="namelist_8h.html#25424c1a15fb43612baeb74b653c7f58">ngz</a> = 25
<a name="l00105"></a>00105   ! <a class="code" href="constrain_8f90.html#7b5f4bf629d634eaa245441e072e7411">constrain</a>
<a name="l00106"></a>00106 !!$    <a class="code" href="namelist_8h.html#d77c3fd14a11442d9065d6cc10fec481">len_tripod</a> = .001
<a name="l00107"></a>00107   <a class="code" href="namelist_8h.html#8ab738c13aa694d7d00cc0cd7fafa087">constrain_proof</a> = .001
<a name="l00108"></a>00108   <a class="code" href="namelist_8h.html#d3ee533830b85aed4f16eebd48017d9f">struct_step</a> = 0
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   ! Read actual inputs from namelist file
<a name="l00111"></a>00111   open(10,file='run.h')
<a name="l00112"></a>00112   read (10,NML=pepcdata)
<a name="l00113"></a>00113 
<a name="l00114"></a>00114  ! <span class="preprocessor"># particles in primary target component</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span>  <a class="code" href="namespacephysvars.html#09f5cde25165ac570993c11da8af5944">npart_total</a> = <a class="code" href="namelist_8h.html#a4fb44be053c6d3f35c09963f7ac2ecc">ni</a>+<a class="code" href="namelist_8h.html#c570850af67b707ee0fabd68903062f7">ne</a>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 ! Adjust local numbers <span class="keywordflow">if</span> total non-multiple of # PEs
<a name="l00118"></a>00118   <span class="keywordflow">if</span> (<a class="code" href="namespacephysvars.html#0decf2aea2fce458b260b471e6478e55">my_rank</a>==0) then 
<a name="l00119"></a>00119      ne_rest = mod(<a class="code" href="namelist_8h.html#c570850af67b707ee0fabd68903062f7">ne</a>,<a class="code" href="namespacephysvars.html#f4969b110a8dac1d6ed43e3af45647a4">n_cpu</a>)
<a name="l00120"></a>00120      ni_rest = mod(<a class="code" href="namelist_8h.html#a4fb44be053c6d3f35c09963f7ac2ecc">ni</a>,<a class="code" href="namespacephysvars.html#f4969b110a8dac1d6ed43e3af45647a4">n_cpu</a>)
<a name="l00121"></a>00121   else
<a name="l00122"></a>00122      ne_rest = 0
<a name="l00123"></a>00123      ni_rest = 0
<a name="l00124"></a>00124   endif
<a name="l00125"></a>00125 
<a name="l00126"></a>00126   <a class="code" href="namespacephysvars.html#f198eb2b475070e5cbc103bdfae9d16a">np_local</a> = npart_total/<a class="code" href="namespacephysvars.html#f4969b110a8dac1d6ed43e3af45647a4">n_cpu</a> + ne_rest + ni_rest  ! total <span class="preprocessor"># particles on this CPU</span>
<a name="l00127"></a>00127 <span class="preprocessor"></span>  <a class="code" href="namelist_8h.html#7dec18d70ba492cad267471889b0dd6f">nep</a> = <a class="code" href="namelist_8h.html#c570850af67b707ee0fabd68903062f7">ne</a>/<a class="code" href="namespacephysvars.html#f4969b110a8dac1d6ed43e3af45647a4">n_cpu</a> + ne_rest ! local # electrons and ions - may be adjusted later
<a name="l00128"></a>00128   <a class="code" href="namelist_8h.html#6c4b21d213fef7eb3c21f8abc98104c6">nip</a> = ni/<a class="code" href="namespacephysvars.html#f4969b110a8dac1d6ed43e3af45647a4">n_cpu</a> + ni_rest
<a name="l00129"></a>00129 
<a name="l00130"></a>00130   <a class="code" href="namespacephysvars.html#eb0ed31ca39b260988b212882598be74">new_label</a> = npart_total  ! Rezone label
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   <span class="keywordflow">if</span> (<a class="code" href="namelist_8h.html#14319507d355791ec5d9d8496e04419a">target_dup</a> .or. <a class="code" href="namelist_8h.html#0650627b79fc23e2652232fe09854e4f">scheme</a>==5) <a class="code" href="namelist_8h.html#4161f5fc188c065e5be391c7888a03c9">np_mult</a> = <a class="code" href="namelist_8h.html#4161f5fc188c065e5be391c7888a03c9">np_mult</a>*2  ! <span class="keywordtype">double</span> up particle array size <span class="keywordflow">if</span> multi-target or ion config mode 
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   <span class="keywordflow">if</span> (.not. <a class="code" href="namelist_8h.html#2bdedf3cae2a62acd8af28e53daed9c0">restart</a>) npart_total = npart_total + 2*SUM(<a class="code" href="namelist_8h.html#c5aa6bea0fcdbc69fe90b8a9bcb31692">n_layer</a>) ! Include particles from remaining layers <span class="keywordflow">for</span> array <a class="code" href="pepc-b_2setup_8f90.html#776bd71acb1bba84c11a03c6e27bd8a9">setup</a>.
<a name="l00135"></a>00135 
<a name="l00136"></a>00136   <a class="code" href="namespacephysvars.html#1ff60eac6a083e1ac61c674793e352cc">beam_config</a>=mod(<a class="code" href="namelist_8h.html#9cd066e24ff6c31a0773858ce2a93967">beam_config_in</a>,10)  ! derived config from s,p variations
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 end subroutine <a class="code" href="pepc-b_2setup_8f90.html#776bd71acb1bba84c11a03c6e27bd8a9">setup</a>
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jan 23 15:57:50 2007 for PEPC by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7-20060810 </small></address>
</body>
</html>
