#!/bin/sh

# Shell script to concatenate graphical and text output from 
# arbitrary number of PEs sharing a series of timestamps

if [ $# = 0 -o "$1" = "-h" -o "$1" = "-help" -o "$1" = "-?" ]; then
    echo "Merges particle data in PE subdirectories and places result in dumps"
    echo "Usage: ../merge1_dump <timestamp> "
    exit
fi

DATADIR=data
WFNAME=parts_dump
TIMESTAMP=$1
# Find PEs
#ls -d pe* > PE_list
cd $DATADIR
#echo "List of timestamps:"; cat timesteps
echo "List of PEs:"; cat PE_list
#echo

	echo "Concatenating $WFNAME.$TIMESTAMP:"
	cat PE_list | while read GNAME
	do
		echo "Adding $GNAME"
		cat $GNAME/parts_dump.$TIMESTAMP >> ../dumps/parts_dump.$TIMESTAMP

	done
	# make copy of info block
	cp pe0000/parts_info.$TIMESTAMP ../dumps/parts_info.$TIMESTAMP
	echo
#echo Compressing ...
#gzip parts_dump.$TIMESTAMP
echo ... done
