# 64-bit hardware

#
#  Makefile for treemp and test programs
#


#DBFLAGS = -g -Rabp -ev  -q64 -qrealsize=8  -qsuffix=f=f90 -qcheck
#LDFLAGS = -q64 -qrealsize=8  -g 
# For apprentice
#FFLAGS =   -eA -m4 -O2,inline4
#LDFLAGS = -lpmpi -Xm -lapp

## For IBM AIX compiler
#FFLAGS = -g -q64 -qrealsize=8 -qsuffix=f=f90 -qcheck  
## Optimised
#FFLAGS =  -q64 -qrealsize=8 -qsuffix=f=f90  -O4 -Q -qipa -qarch=pwr4 -qstrict -qreport  -qlist -qsource -I/usr/local/include 

IPA=-qipa=list=long:inline=key2addr:inline=make_hashentry
PG=-pg -g -qfullpath
HPM = -lhpm
LISTING=-qreport -qlist -qlistopt -qsource 
#MPITRACE=/home/test/pospiech/tools/power4_trace/mpi_trace64.o
MPITRACE=
FFLAGS1 = -q64 -qrealsize=8 -qsuffix=f=f90 -qsuffix=cpp=F90  -O3 -g -Q -qarch=pwr4 -qtune=pwr4 $(IPA) -I.
# $(PG) $(HPM)

FFLAGS =  $(FFLAGS1) -qsclk=micro 


#ANALYS = -lpmpi -Xm -lpat pat.cld

# Visit libraries
# cray
#VISITLIBS=-L /usr/local/visit/lvisit/apis/spk2 -llvisit_spk -L/usr/local/visit/lvisit/lib -llvisit -L/usr/local/visit/visit20/lib -lvisit 
# JUPP
#VISITLIBS=-L/home/admin/beta/visit-2.0b/lvisit/apis/spk3 -llvisit_spk -L/home/admin/beta/visit-2.0b/lvisit/lib -llvisit -L/home/admin/beta/visit-2.0b/lib -lvisit 
VISITLIBS= -L/home/zam/zdv036/tree/spkvisit -llvisit_spk -L/home/admin/beta/visit-2.0b/lvisit/lib -llvisit -L/home/admin/beta/visit-2.0b/lib -lvisit 

LDFLAGS = $(VISITLIBS) 
.SUFFIXES: .f90

sum_force=sum_force.f90
#sum_force=sum_force_explicit.f90
#sum_force=sum_force_static.f90

FC = /usr/bin/mpxlf90_r

# -------------------------------------------------------------------------------------------
# Source files

MODULES.f90 =  my_mpidefs.f90 treevars.f90 utils.f90


SOURCES.f90 =	treemp.f90 \
		setup.f90 \
		configure.f90 randion.f90 predef_parts.f90 maxwell1.f90 cold_start.f90 \
		scramble_v.f90 reset_ions.f90 \
		beam.f90 beam_control.f90 \
		mc_config.f90 \
	 	make_domains.f90 \
		tree_build.f90  make_branches.f90 tree_fill.f90 tree_properties.f90 \
		tree_walk.f90 \
		energy_cons.f90 potenergy.f90 sumpot.f90 kinenergy.f90\
		forces.f90 forces_bal.f90 $(sum_force) \
		fpond.f90 \
		velocities.f90 \
		push.f90 constrain.f90 \
		make_hashentry.f90 get_address.f90  get_node.f90 \
		diagnostics.f90 \
	        diagnose_tree.f90 check_table.f90 \
		draw_domains.f90 draw_tree2d.f90 draw_lists.f90\
		vis_parts.f90 vis_fields.f90 dump.f90 visit_dump.f90\
		open_files.f90 close_files.f90	\
		densities.f90 \
		track_nc.f90		

# -------------------------------------------------------------------------------------------
# Source combinations

SOURCES = $(MODULES.f90) \
	  $(SOURCES.f90) 

SRCKEY = $(MODULES.f90) \
	 $(SRCKRY.f90) 

# Dependencies

###$(SOURCES.f90): $(MODULES.f90)

# Names of object files derived from sources

OBJECTS = $(SOURCES.f90:.f90=.o)
MODS =  $(MODULES.f90:.f90=.o)

all: mods pepc

#  compile mode
.f90.o:   
	$(FC) -c $(FFLAGS) $(VISITLIBS) $(DBFLAGS) $<

tree_properties.o:   tree_properties.f90
	$(FC) -c $(FFLAGS1) $(DBFLAGS) $<

diagnose_tree.o:   diagnose_tree.f90
	$(FC) -c $(FFLAGS1) $(DBFLAGS) $<

tree_walk.o:   tree_walk.f90
	$(FC) -c $(FFLAGS1) $(DBFLAGS) $<

# -----------------------------------------------------------------------------------------
#  targets

mods:   $(MODS) 

pepc:	$(OBJECTS) 
	$(FC)  $(FFLAGS) $(LDFLAGS) -o $@ $(OBJECTS) $(MODS) $(MPITRACE)

debug:	$(OBJECTS)
	@echo "Loading object files using flags $(DBFLAGS)"
	$(FC) $(LDFLAGS)  $(VISITLIBS) $(DBFLAGS)  -o $@ $(OBJECTS)


rand:	 rantest.o
	$(FC) $(FFLAGS) -o rand rantest.o


clean:
	/bin/rm -f bin/*.o  *% *~ bin/key rand *.o *.pif core pepc *.mod 

cleanbin: /bin/rm -r pepc debug core

cleancore: 	
	/bin/rm  make_domains.o treebuild.o  make_branches.o \
		tree_fill.o tree_properties.o tree_walk.o \
		energy_cons.o potenergy.o sumpot.o kinenergy.o \
		forces.o sum_force.o \
		fpond.o push.o make_hashentry.o get_address.o  get_node.o 

cleandata: 
	/bin/rm -f fort.* *.dat *.out *.gle 

depend:
	./f90depend -u -I/usr/lpp/ppe.poe/include *.f90
default: treemp

### DO NOT DELETE OR EDIT THIS LINE
# Everything from here on down is generated by f90depend
# so do NOT add any translation rules below here.

#--- Include-Dependencies

driver.o: /usr/lpp/ppe.poe/include/mpif.h
my_mpidefs.o: /usr/lpp/ppe.poe/include/mpif.h


#--- Module-Dependencies

beam.o: treevars.o utils.o
beam_control.o: treevars.o utils.o
boundaries.o: treevars.o
check_table.o: treevars.o utils.o
close_files.o: treevars.o
cold_start.o: treevars.o utils.o
configure.o: treevars.o utils.o
constrain.o: treevars.o utils.o
diagnose_tree.o: treevars.o
diagnostics.o: treevars.o utils.o
draw2d.o: treevars.o
draw2d_hash.o: treevars.o
draw_domains.o: treevars.o
draw_lists.o: treevars.o
draw_tree2d.o: treevars.o
driver.o: utils.o
dump.o: treevars.o
energy_cons.o: treevars.o utils.o
forces.o: treevars.o utils.o
forces_bal.o: treevars.o utils.o
forces_new.o: treevars.o utils.o
forces_nobal.o: treevars.o utils.o
get_address.o: treevars.o utils.o
get_node.o: treevars.o utils.o
keytest.o: treevars.o
kinenergy.o: treevars.o
make_branches.o: treevars.o utils.o
make_domains.o: treevars.o utils.o
make_hashentry.o: treevars.o utils.o
mc_config.o: treevars.o utils.o
open_files.o: treevars.o
potenergy.o: treevars.o utils.o
predef_parts.o: treevars.o utils.o
push.o: treevars.o
randion.o: treevars.o utils.o
reset_ions.o: treevars.o
scramble_v.o: treevars.o utils.o
setup.o: treevars.o utils.o
sum_force.o: treevars.o
sumpot.o: treevars.o
tree_build.o: treevars.o utils.o
tree_fill.o: treevars.o utils.o
tree_properties.o: treevars.o utils.o
tree_walk.o: treevars.o utils.o
treemp.o: treevars.o utils.o
treevars.o: my_mpidefs.o
utils.o: my_mpidefs.o
velocities.o: treevars.o utils.o
visit_dump.o: treevars.o
visualize.o: treevars.o


