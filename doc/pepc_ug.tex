\documentclass[11pt,psfig]{article}
\setlength{\textheight}{21.80cm}
\setlength{\textwidth}{15.20cm}
\setlength{\oddsidemargin}{0cm}
\usepackage{graphicx}
%\usepackage{graphics}
\usepackage{longtable}
\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{color}
\usepackage{underscore}
\usepackage{html}

\renewcommand{\theequation}{\thesection.\arabic{equation}}
 %  MACROS:

\def\mco{\multicolumn}
\def\epp{\epsilon^{\prime}}
\def\vep{\varepsilon}
\def\ra{\rightarrow}
\def\ppg{\pi^+\pi^-\gamma}
\def\vp{{\bf p}}

\def\be{\begin{equation}}
\def\ee{\end{equation}}
\def\bi{\begin{enumerate}}
\def\ei{\end{enumerate}}
\def\bes{\[}
\def\ees{\]}
\def\bea{\begin{eqnarray}}
\def\eea{\end{eqnarray}}
\def\bar{\begin{eqnarray*}}
\def\ear{\end{eqnarray*}}
\def\CPbar{\hbox{{\rm CP}\hskip-1.80em{/}}}%temp replacement due to no font

\newcommand{\pepc}{{\sc pepc}}
\newcommand{\meno}{{\medskip\noindent}}
\newcommand{\bm}[1]{\mbox{\boldmath$#1$}}
\newcommand{\dbyd}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\dd}[2]{\frac{d #1}{d #2}}
\newcommand{\ddt}[1]{\frac{d #1}{d t}}
\newcommand{\curl}{\nabla\bm{\times}}
\newcommand{\half}{{1/2}}
\newcommand{\third}{{1/3}}
\newcommand{\quarter}{{1/4}}
\newcommand{\fhalf}{\frac{1}{2}}
\newcommand{\fthreehalf}{\frac{3}{2}}
\newcommand{\fthird}{\frac{1}{3}}
\newcommand{\threehalf}{{3/2}}
\newcommand{\fourthirdpi}{\frac{4\pi}{3}}
\newcommand{\rootpi}{\pi^{\half}}
\newcommand{\Dx}{\Delta x}
\newcommand{\Dt}{\Delta t}
\newcommand{\rij}{\bm{r}_{ij}}

\newcommand{\onemd}{(1-\delta^2)^{\frac{1}{2}}}
\newcommand{\omp}{$\omega_{p}$}
\newcommand{\ompom}{$\omega_{p}/\omega_{0}$}
\newcommand{\cop}{$c/\omega_{p}$}
\newcommand{\Lola}{$L/\lambda$}
\newcommand{\lola}{$L/\lambda$}
\newcommand{\Ilam}{$I\lambda^{2}$}
\newcommand{\Wcmu}{~Wcm$^{-2}\mu$m$^{2}$}
\newcommand{\Wcm}{~Wcm$^{-2}$}
\newcommand{\wcm}{~Wcm$^{-2}$}
\newcommand{\Weight}{$10^{18}$~Wcm$^{-2}$}
\newcommand{\Wnine}{$10^{19}$~Wcm$^{-2}$}
\newcommand{\Jcm}{~Jcm$^{-2}$}
\newcommand{\nonc}{$n_{e}/n_{c}$}
\newcommand{\voc}{$v_{os}/c$}
\newcommand{\vteoc}{$v_{te}/c$}
\newcommand{\vte}{$v_{te}$}
\newcommand{\cmcub}{~cm$^{-3}$}
\newcommand{\gcm}{~gcm$^{-3}$}
\newcommand{\mum}{~$\mu$m}
\newcommand{\cross}{\bm{\times}}
\newcommand{\crossb}{\bm{\times}}
\newcommand{\vcrossb}{$\bm{v\times B}$}


\newcommand{\etal}{\textit{et al.}}
\newcommand{\eq}[1]{Eq.~(\ref{#1})}
\newcommand{\vxB}{\bm{v\times B}}
\newcommand{\jxB}{\bm{j\times B}}
%\newcommand{\deg}{$^\circ$}
\newcommand{\kalpha}{K$_\alpha$}
\newcommand{\eminus}{e$^{-}$}

\newcommand{\upbox}[1]{^{\mbox{\scriptsize\rm #1}}}
\newcommand{\downbox}[1]{_{\mbox{\scriptsize\rm #1}}}
\newcommand{\nph}{^{n+\frac{1}{2}}}
\newcommand{\nmh}{^{n-\frac{1}{2}}}
\newcommand{\np}{^{n+1}}
\newcommand{\nm}{^{n-1}}
\newcommand{\mpo}{^{m+1}}
\newcommand{\mmo}{^{m-1}}
\newcommand{\mph}{^{m+\frac{1}{2}}}
\newcommand{\mmh}{^{m-\frac{1}{2}}}
\newcommand{\ip}{_{i+1}}
\newcommand{\im}{_{i-1}}
\newcommand{\jp}{_{j+1}}
\newcommand{\jm}{_{j-1}}
\newcommand{\iph}{_{i+\frac{1}{2}}}
\newcommand{\imh}{_{i-\frac{1}{2}}}
\newcommand{\jph}{_{j+\frac{1}{2}}}
\newcommand{\jmh}{_{j-\frac{1}{2}}}
\newcommand{\hs}[1]{\hspace{#1 cm}}
\newenvironment{cols}[9]{
\begin{tabbing}
\hspace{.5cm} \= \hspace{3.5cm} \= \hspace{3.5cm} \= \\ \> \texttt{#1} \> \texttt{#2} \> \texttt{#3} \\ \> \texttt{#4} \> \texttt{#5} \> \texttt{#6} \\ \> \texttt{#7} \> \texttt{#8} \> \texttt{#9}}
{\end{tabbing}}

\title{PEPC User Guide\\}
\author{\\ Paul Gibbon \\ \\ \\
John von Neumann Institute for Computing, ZAM,\\
Forschungszentrum J\"ulich GmbH, D--52425 J\"ulich, Germany\\ \\  {\tt p.gibbon@fz-juelich.de} \\\\
}


\begin{document}

\maketitle
\pagebreak

\begin{tableofcontents}
%%%%% Need not to input any data here. 
%%%%% System will input automatically.
\end{tableofcontents}

\pagebreak

\section{Introduction}
\normalsize
PEPC --- Pretty Efficient Parallel Coulomb-solver --- is a parallel tree-code 
for rapid computation of long-range Coulomb forces, based on the original
Barnes-Hut (sequential) algorithm and using concepts taken from the
Warren-Salmon `Hashed Oct Tree' scheme.  A description of the algorithm can be
found in the technical report pepc\_alg.ps and some recent variations of the parallel tree
traversal routine in parco05.pdf, a reprint from the ParCo 2005 conference proceedings.

\medskip\noindent
The public version is divided into kernel routines and `front-end'
applications, which after unpacking the tarball and going to the installation
directory (e.g.: {\tt \$HOME/pepc}) should be structured as follows:
\begin{tabbing}
\hspace{1cm} \= \hspace{4cm} \= \hspace{1cm} \\
\> \texttt{lpepcsrc} \> kernel library routines for {\tt lpepc}\\
\> \texttt{pepc-b} \> source code for laser-plasma application \\
\> \texttt{tutorial} \> example run directory for {\tt pepcb}\\
\> \texttt{pepc-e} \> source code for simple MD demo program \\
\> \texttt{doc} \> documentation\\
\> \texttt{bin} \> helper scripts and binaries\\
\> \texttt{tools} \> postprocessing and graphics tools
\end{tabbing}

\noindent 
The physical model for the laser-plasma application is described in the Physics of Plasmas reprint pop04.pdf.


\section{Compiling {\sc pepc}} 

The source code for the tree kernel routines (fortran-90) resides in directory
lpepcsrc, but is designed to be compiled from the installation directory via a configure script, where all the machine-dependent options are determined.

\medskip\noindent
To build the laser-plasma application {\tt pepcb}, first go to the top directory
{\tt pepc} and try and run the configure script:

\begin{verbatim}
./configure
\end{verbatim}

Machine options are in \texttt{config.in}.  These can be edited and a new configure script created with \texttt{autoconf}.

Current builds are available for:
\begin{tabbing}
\hspace{1cm} \= \hspace{3cm} \= \hspace{1cm} \=\\
\> \texttt{linux} \> ... \> Linux-based PC, Intel compiler\\
\> \texttt{ibm-p690} \> ... \> IBM p690 Regatta (Power4)\\
\> \texttt{bgl} \> ... \> BlueGene/L \\
\end{tabbing}

A full list of options can be obtained with:
\begin{verbatim}
./configure --help
\end{verbatim}

The configure script generates makefiles in the source directories from the \texttt{makefile.in} fields.  Once you are satisfied with the compiler options and libraries, do:

\begin{verbatim}
   > (make clean)
   > make
\end{verbatim}


\medskip\noindent
At this point there may well be linker errors because of missing
libraries, such as MPI or from VISIT/XNBODY, the visualisation packages.  MPI is
currently a prerequisite, even if the code is run on a single processor.  For
single-CPU Linux users, this means installing the {\tt mpich} package first, available on
most distributions. 


\section{Running the code}

Before running \textsc{pepc} you need to create a run directory with a
particular structure to accommodate the output data produced.  One such run
directory {\tt tutorial} is supplied, which can be copied to create new
projects. Because the
code is designed with very large $(P>1000)$ numbers of processors in mind,
each CPU has its own subdirectory for dumping particle data and placing
diagnostic output.  These are in the {\tt data} directory with labels
{\tt pe0000, pe0001} etc., so that a listing will look something like this:
\begin{verbatim}
   > cd  $(PEPC_HOME)/tutorial
   > ls -l data
   PE_list     PE_newlist  pe0000      pe0001      pe0002      pe0003  
   pe0004      pe0005      pe0006      pe0007
\end{verbatim}

\noindent 
The file {\tt PE\_list}, also to be found in the run directory itself, contains
a list of subdirectories.  This is used by bookkeeping scripts to assist in handling the
output data and maintain the file structure (see Sec.~\ref{output})



\medskip\noindent
Input parameters are currently read in via a Fortran namelist, whose members
are given in {\tt pepc-b/namelist.h} and defined in pepc-b/physvars.f90.  This has the advantage of relatively
flexible formatting of the variables, not all of which have to be present.
Many of the switches have default settings such that they can be ignored if
not needed.  A full explanation of the input parameters is given in
Sec.~\ref{inputs}. The input deck itself, e.g.: {\tt eqm.h}, looks something
like this:

\small
\begin{verbatim}
 &pepcdata

! particles
  ne = 4000
  ni = 4000

! physics stuff
  plasma_config = 1  
  target_geometry = 1   
  theta = 0.5
  Te_keV = 0.5 
  Ti_keV =0.
  mass_ratio = 500.
  q_factor = 1.
  coulomb = .true.
  lenjones = .false.
  bond_const = 2.e-3
  r_sphere = 4
  x_plasma = 1.    
  y_plasma = 2.     
  z_plasma = 2.     
  xl = 5  
  yl =5
  zl =5

! beam
  beam_config_in=0  
  vosc = 0.1
  omega = 0.5
  sigma = 6.
  tpulse = 20.
  lambda = 1.0   

! control
  nt =500
  dt = 0.3
  eps = 2.5
  restart = .false.
  vis_on = .false.
  steering = .false.
  ivis = 5
  ivis_fields = 5000
  idump = 4000
  iprot=2
  itrack=300
  particle_bcs = 1
  scheme = 1 /
\end{verbatim}

\normalsize

\noindent
To start the run script:
\begin{verbatim}
   > ./eqm.sh
\end{verbatim}

\noindent
This example will set up a random plasma sphere of radius 2 $c/\omega_p$ comprising 4000 electrons and
4000 ions, having initial temperatures of 500~eV and 0~eV respectively. The
ion mass is 2000 times larger than the electron mass, or more correctly:
$Zm_e/m_i = 1/2000$.  The laser/particle beam is switched off, so the system
will simply adjust until the electrons are in thermal equilibrium.

\section{Input parameters and switches \label{inputs}}

\subsection{Plasma configuration:  {\tt plasma\_config}}
\begin{verbatim}
 0   no plasma
 1   plasma with randomly placed particles according to geometry
 2    special  - user-defined particle positions/velo specified through 
      call to special_start(ispecial), where ispecial means:
                1,2=disc;
                3=box with velocities in x,y plane (B test)
                4=config from file for FMM comparisons (x,y,z,q)
                5=particle beam with np_beam=max(ne,ni)
\end{verbatim}

\subsection{Geometries:  {\tt target\_geometry}}
\begin{verbatim}
    0  slab with dimensions:   x_plasma * y_plasma * z_plasma
    1  sphere radius r_sphere
    2  disc, radius r_sphere, thickness x_plasma
    3  wire, radius r_sphere, length z_plasma
    4  ellipsoid, radii x_plasma, y_plasma, z_plasma
    5  wedge, flat side y_plasma * z_plasma, depth x_plasma
    6  hemisphere, radius r_sphere
    7  spherical shell,  radius r_sphere, thickness x_plasma
    8  hemispherical shell, radius r_sphere, thickness x_plasma
    9  not defined
   10  not defined 
\end{verbatim}

\subsection{Integrator schemes:  {\tt scheme}}
\begin{verbatim}
    1  conserve total energy
    2  constant Te and Ti 
    3  global Te conserved
    4  local  Te conserved
    5  Ion temperature Ti moderated (for artificial Lennard-Jones mode) 
    6  Full 3V electromagnetic Boris pusher  
\end{verbatim}

\subsection{Particle, laser beam or external fields:   {\tt beam\_config\_in}}
  External field selected in routine {\tt force\_laser}
  after internal fields computed in {\tt pepc\_fields}

\begin{verbatim}

 default:  
     0    beam/external fields off
     1    Fixed cylindrical particle beam
     2    Constant particle source
     8    Dust particle

 laser model: 3-5

      3   Uniform sinusoid in z (s-pol)
                Epond = (0, 0, vosc*omega*sin(omega*tlaser) )

      4   Standing wave ponderomotive force, normally incident
                function call: fpond( tlaser, tpulse,sigma,vosc,omega,rho_upper )
                tpulse  FWHM sin^2 pulse duration (in wp**-1)
                sigma   FWHM spot size (c/omega_p**-1)
                vosc    pump strength p_osc/m_e c
                omega   normalized laser frequency omega_0/omega_p
 
    Special cases:
     94   standing wave fpond with transverse fields artificially reduced
              epon_y=epon_y/100.
              epon_z=epon_z/100.

     14   oblique incidence standing wave, s-pol
             emobliq( tlaser, tpulse,sigma,vosc,omega,theta_beam,rho_upper)

TODO: 24   oblique incidence standing wave, p-pol

      5  Propagating fpond - wakefield mode
            laser_bullet( tlaser, focus(1), tpulse,sigma,vosc,omega)
      6  Plane wave with Gaussian radial profile (pond. force tests)
      7  Uniform Bz

\end{verbatim}

\subsection{Run control: I/O switches}

\begin{verbatim}

  restart       (.false.)   restart switch: config read from parts_all.in
  coulomb       (.true.)    compute Coulomb forces
  bfields       (.false.)   include magnetic fields - not yet implemented
  lenjones      (.false.)   include short-range Lennard-Jones potential
  vis_on        (.true.)    online visualisation on/off
  steering      (.false.)   VISIT steering switch
  target_dup    (.false.)   target duplication switch
  ramp          (.false.)   profile-ramp switch
  mc_init       (.false.)   MC initialisation switch


  idim=3   # dimensions (velocity and position updates)

  scheme =      (1)  integrator scheme switch: 2-4= const. Te dynamics, 6=EM
  particle_bcs  (1)  particle BC switch: 1=open, 2=reflective
  debug_level   (1)  debug level for printed O/P
  debug_tree    (0)  debug level for tree diagnostics O/P
  ncpu_merge    (1)  restart control: -1 = split single particle data file amoung all CPUs
                                       1 = 1 file/CPU
                                       N = merge N files per CPU
  np_error      (1)   # particles in error test sample
  mc_steps      (1)   # steps in MC mode


   dt                   timestep
   nt                   # timesteps 
   idump                particle dump output frequency (timesteps)
   iprot        (1)     protocoll frequency
   ivis         (5)     frequency for particle shipping to VISIT
   ivis_fields  (10)    frequency for field shipping to VISIT
   ivis_domains (10)    frequency for domain shipping to VISIT
   itrack               frequency for computing ion density (tracking)
   ngx, ngy, ngz        grid dimensions for field dumps

tree stuff:
   theta                (0.5)   clumping parameter
   force_tolerance      (1.)    permitted error in force calculation (not yet implemented)
   walk_scheme          (0)     tree walk switch:  0 = asynchronous multipole exchange
                                                   1 = collective exchange
                                                   2 = prefetch
                                                   3 = tree-freeze mode
   mac                  (0)     Multipole acceptance criterion:
                                                   0 = Barnes-Hut s/d<theta

   balance              (1)     load balancing switch:  0 = balance # particles
                                                        1 = balance interaction lists
   ifreeze              (1)     tree-rebuild frequency in freeze mode (walk_scheme=3)


\end{verbatim}



\section{Handling the output data \label{output}}

\noindent
The output files will be stored either in the run directory or in the
subdirectories data/pe0000 etc.  The most important of these are:

\begin{tabbing}
\hspace{1cm} \= \hspace{3cm} \= \hspace{1cm} \=\\
\> \texttt{energy.dat}  \>  Kinetic and potential energies etc., expressed in keV
\textit{per particle.} \\
\> \>         9 y-columns in ASCII format, containing the following:\\
\> \>         $\omega_pt$, $U_{pot}$, $U_{mag}$, $U_{kin-e}$, $U_{kin-i}$, 
$U_{beam}$, $U_{tot}$, $I_{pond}$, $x_c$\\

\> \texttt{run.out} \>         Printed diagnostics\\

\> \texttt{load_TTT.dat} \>   Shows approx load balance amoung CPUs at
timestep TTT
\end{tabbing}

\subsection{Particle data}

Particle data is output independently by each CPU to avoid memory and MPI
bottlenecks for large runs, and can be found in:

\begin{verbatim}
  data/peNNNN/parts_dump.TTTTTT,
  data/peNNNN/parts_info.TTTTTT,
\end{verbatim}

\noindent 
Currently the format of the particle dump is a 14-column ASCII file (12 floats,
2 integers) with the following content: 

\begin{verbatim}
  x, y, z, px, py, pz, q, m, Ex, Ey, Ez, pot, owner, label
\end{verbatim}

\noindent
The number of particles written out together with other data is contained in
the associated info file.  Each subdirectory peNNNN contains data for CPU NNNN at the checkpoint
timestamps TTTTTT, whose frequency is controlled by the input parameter
\texttt{idump}.  Data for each CPU can be merged for postprocessing with the script
merge1_dump located in the {\tt bin} directory (which should be included in
you path with {\tt export PATH=$PATH:$PEPC_HOME/bin} or equivalent), for example:

\begin{verbatim}
   > merge1_dump TTTTTT
\end{verbatim}

\noindent
will produce will create 2 new files in the subdirectory dumps
in the same format as the partial dumps.  These can either be used by a
postprocessor or as an initial configuration for a new run.

\begin{verbatim}
  dumps/parts_dump.TTTTTT
  dumps/parts_info.TTTTTT
\end{verbatim}


\noindent
Additional scripts exist for maintaining the subdirectories.  For example

\begin{verbatim}
   > create_pes NN      
\end{verbatim}

\noindent 
adds NN subdirectories starting with the last CPU in the file \texttt{PE_list}.

\meno
Also,

\begin{verbatim}
  > clean_pes
\end{verbatim}

\noindent
cleans \textit{all} subdirectories contained in \texttt{data/PE_list}.


\subsection{Gridded data}

\subsection{Tree kernel diagnostics:}

\begin{tabbing}
\hspace{1cm} \= \hspace{3cm} \= \hspace{1cm} \=\\
\> \texttt{tree_NNN.gle} \>    2D plot of tree structure for CPU \# NNN in GLE
format \\
\> \texttt{tree2d.gle} \> Driver file for combining plots \\

\> \texttt{domain_NNN.gle} \>  2D plot of branch nodes for CPU \# NNN \\
\> \texttt{domains.gle} \> Driver file\\

\> \texttt{list_NNNIII.gle} \>   Interaction list of particle III on CPU NNN\\
\> \>                  Useful for checking effect of changing clumping
parameter theta.\\
\end{tabbing}


\noindent
These and other .gle files can be viewed using the graphics program GLE
(Graphics Layout Engine), currently available from:

\begin{verbatim}
        http://glx.sourceforge.net
\end{verbatim}



\section{Using the GMT imaging software for 2D plots}

\noindent
Graphical output from PEPC can be created using the
postprocessor \texttt{slicer}, which converts the particle data into
'fluid' quantities such as mass density, flow velocity and temperature
etc. on a 3D grid.  This is then used to create 2D slices/projections
in the xy and xz planes, along with lineouts at positions specified in
an input file.

\meno
The particle data is assumed to be in the form of the PEPC dump file:

\begin{verbatim}
   x, y, z, px, py, pz, q, m, Ex, Ey, Ez, potential, owner, plabel
\end{verbatim}

\noindent
The postprocessor program slicer.f90 is in the \texttt{tools} directory.  To
(re)compile it, use:

\begin{verbatim}
  > make clean 
  > make slicer
\end{verbatim}

\noindent 
The input files read by this program from the run directory are:

\begin{verbatim}
   grid_defs.in
   dumps/parts_info.TTTTTT
   timestamps
\end{verbatim}

\noindent
where TTTTTT is the snapshot timestep.  This should be entered in the
\texttt{timestamps} file, which may contain a snapshot series.  If \texttt{timestamps}
is empty, a new one will be generated by inspecting \textit{all} the
parts_info.* in the run directory -- not recommended if there are a large
number of snapshots.


\meno
An example of the \texttt{grid_defs.in} file is given below.  The slicer
program assumes formatted data, so care should be taken not to alter
the order or integer/float representation of the numbers.  The
variable names in front of the equals sign can be changed, however.
Parameters missing a comment are currently not used.

\small
\begin{verbatim}
       n= 1000000        # particles to process
     ngx= 200            # grid points in x
     ngy= 200            # grid points in y
     ngz= 50             # grid points in y
    ngux= 100            #  "     "    in vx
    nguy= 100            #  "     "    in vy
    nguz= 100            #  "     "    in vz
  nalpha= 100

    xmin= 100.           box xmin
    xmax= 600.0          box xmax
   xtick= 100.           box tick interval on x-axis
    ymin= 200.0          box ymin
    ymax= 700.0          box ymax
   ytick= 100.0          interval y-axis
    zmin= -50.0          box zmin
    zmax= 150.0          box zmax
   ztick= 100.0          interval z-axis

   uxmin= -5.0           box vxmin for phase space plots
   uxmax= 5.0            box vymax
  uxtick= 2.5            interval
   uymin= -5.0           box vymin
   uymax= 5.0            box vymax
  uytick= 2.5            interval
   uzmin= -2.0           box vzmin
   uzmax= 2.0            box vzmax
  uztick= 1.0            interval
 umevmax= 20.            energy threshold

  uximin= -3.0           box parameters for 2nd species
  uximax= 3.0            (presently unused)
 uxitick= 1.5
  uyimin= -3.0
  uyimax= 3.0
 uyitick= 1.5
  uzimin= -3.0
  uzimax= 3.0
 uzitick= 1.5
uimevmax= 1.
   aimin= -60.
   aimax= 60.
  uimev1= 1.
  uimev2= 3.

  yslice= 400.0          y-position of slice for xz plots
  zslice= 50.0           z-position of slice for xy plots
  xrear = 80.0
  mratio= 1836.           Mass density scaling factor
  rhomax= 0.             Max density (log scale)
   temin= 0.001
   temax= 0.1
    tmin= 0.001          min temperature
    tmax= 0.3            max temperature
   jemax= 1.0
    vmax= 2.0            max velocity
    emax= 0.5            max E field
   fpmax= 10.
   jevec= 10.
    vvec= 5.             scaling factor for velocity arrows
    evec= .5                "      "     "   field arrows
     eps= 1.0
   tcold= 100.0

    xbox= 2.
    ybox= 2.
    zbox= 2.
  yshift= 3.6            vertical shift (inches) for plot legend
  zshift= 3.6
  pshift= 3.4            as above for phase-space plots

 iskip3d=1
\end{verbatim}
\normalsize

\noindent
The slicer program can be used on its own to generate gridded data -
these subsequently appear in a subdirectory \texttt{pepc/TTTTTT} corresponding to the
to \texttt{parts_info.TTTTTT}.

\noindent 
Tips:
\begin{enumerate}
\item      Make sure the grid lengths (ie: xmax-xmin etc.) are easily
 divisible by the number of mesh points (ngx).
\item     Use a coarse grid to start with (eg 100x100x50) and refine later.
\item    For quick previews, reduce the number of particles read in.
\end{enumerate}

\noindent
For convenience, a number of scripts are made available which combine the
\texttt{slicer} output with command-line graphics tools from the GMT (Generic Mapping
Tools) package. The latter is assumed to be installed locally under
\texttt{\$HOME/gmt}, with the appropriate environment (GMTHOME) and
path variables set. If not, it is freely available from

\begin{verbatim}
        http://gmt.soest.hawaii.edu/
\end{verbatim}

The postprocessing scripts are located in \texttt{pepc/bin} and have the form:

\begin{verbatim}
  make_density 
  make_snaps
\end{verbatim}

\noindent 
etc.  Calling a script without parameters will usually result in a
help message, for example:

\begin{verbatim}
   > make_snaps
   Call parameters:  run# runpp/nopp plot/noplot
   >
\end{verbatim}

\noindent
First, the script checks whether the particle data have already been merged from
the 'pe' directories.  If so, there will be a large file in \texttt{dumps/parts_dump.TTTTTT}
If not, the \texttt{merge1_dump} script is called to do this task.  Then, the slicer program
is called to produce the gridded data in \texttt{TTTTTT/xy_slice_den} etc.
Finally, a series of GMT tools are called to generate the images.

\meno
The \texttt{make_snaps} script will produce snapshots for the whole sequence
given in the timestamps file, eg: suppose the timestamps file contains:

\begin{verbatim}
  000100
  000200
  000300
\end{verbatim}

\noindent
Then:

\begin{verbatim}
   > make_snaps disc1 runpp plot
\end{verbatim}

\noindent
will perform the postprocessing and produce plots at timesteps 100, 200
and 300.  The first parameter is an arbitary run label which will get stamped
on the corner of the plots together with the date for identification purposes.
Use the \textit{runpp} option the first time you generate grid data, or if you change
any parameters in the \texttt{grid_defs.in} file.  Otherwise, \textit{nopp} will use the available
data and jump straight to the graphics tools.  The \textit{noplot} option can be used to
suppress postscript image generation (postprocess only).

\meno
The plots are in high-quality postscript format and are placed in subdirectory 
\texttt{pepc/plots/}.
A compressed tar file \texttt{images.tar.gz} containing \textit{all} plots is also generated by the script.
Fine-tuning of the plots can be done by editing the scripts --
\texttt{make_snaps}, etc.  This will require some knowledge of the GMT package, which is
comprehensively documented in GMT_Docs.pdf and GMT_Tutorial.pdf from the distribution.

\section{Online visualization with VISIT and XNBODY}

\end{document}










%%% Local Variables: 
%%% mode: plain-tex
%%% TeX-master: t
%%% End: 

