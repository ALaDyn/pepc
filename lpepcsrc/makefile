#
#  Makefile for PEPC library kernel
#
#  --------------------------------

#  Machine-dependent options defined in program source directory
#  (eg: copied from pepc-b/ibm-p690.mk - see top-level makefile there)

include arch.mk

FFLAGS =  $(FFLAGS1) $(Q64) $(TUNE)
DBFLAGS = $(DB)
LDFLAGS = $(MPITRACE)

pepclib = liblpepc.a

.SUFFIXES: .f90



# -------------------------------------------------------------------------------------------

# Source files

#-------------------------------------------------------------------------------------------

# Pepc library

PEPCMOD.f90 =  treevars.f90 utils.f90 tree_utils.f90
PEPCSRC.f90 =  tree_domains.f90 setup_treearrays.f90 \
		tree_build.f90  tree_branches.f90 tree_fill.f90 tree_properties.f90 \
		tree_aswalk.f90	tree_cowalk.f90 tree_prefetch.f90 sum_force.f90 sum_bfield.f90 \
	        tree_update.f90  sum_force_split.f90 \
		make_hashentry.f90 get_address.f90  get_node.f90 key_test.f90 get_next_node.f90 \
	        diagnose_tree.f90 check_table.f90 sum_lennardjones.f90 sum_bond.f90 \
		draw_domains.f90 draw_tree2d.f90 draw_lists.f90 \
		fields.f90 fields_p.f90 

POBJS = $(PEPCSRC.f90:.f90=.o)
PMODS =  $(PEPCMOD.f90:.f90=.o)


# --------------------------------------------------

#  compile mode for PEPC routines 
#

#  compile mode
.f90.o:   
	$(FC) -c $(FFLAGS) $(INCLUDE) $(DBFLAGS) $<

$(pepclib): lpepc

lpepc:  $(POBJS) $(PMODS) arch.mk
	@echo "Creating PEPC library ..."
	rm -f liblpepc.a
	$(AR) q liblpepc.a $(POBJS) $(PMODS)
	$(RANLIB) liblpepc.a
	@echo "... done"

mods:   $(PMODS) 

debug:	$(OBJECTS)
	@echo "Loading object files using flags $(DBFLAGS)"
	$(FC) $(LDFLAGS)  $(VISITLIBS) $(DBFLAGS)  -o $@ $(OBJECTS)

default: lpepc

clean:
	/bin/rm -f liblpepc.a bin/*.o  *% *~ bin/key rand *.o *.pif core *.mod 

cleanbin: /bin/rm -r pepc debug core

cleancore: 	
	/bin/rm $(POBJS) 

cleandata: 
	/bin/rm -f fort.* *.dat *.out *.gle 

depend:
	$(F90DEP)

default: treemp

### DO NOT DELETE OR EDIT THIS LINE
# Everything from here on down is generated by f90depend
# so do NOT add any translation rules below here.

#--- Include-Dependencies

fields.o: /usr/lpp/ppe.poe/include/thread/mpif.h
fields_p.o: /usr/lpp/ppe.poe/include/thread/mpif.h
get_address.o: /usr/lpp/ppe.poe/include/thread/mpif.h
setup_treearrays.o: /usr/lpp/ppe.poe/include/thread/mpif.h
tree_branches.o: /usr/lpp/ppe.poe/include/thread/mpif.h
tree_build.o: /usr/lpp/ppe.poe/include/thread/mpif.h
tree_domains.o: /usr/lpp/ppe.poe/include/thread/mpif.h
tree_fill.o: /usr/lpp/ppe.poe/include/thread/mpif.h
tree_prefetch.o: /usr/lpp/ppe.poe/include/thread/mpif.h
tree_properties.o: /usr/lpp/ppe.poe/include/thread/mpif.h
tree_update.o: /usr/lpp/ppe.poe/include/thread/mpif.h
tree_utils.o: /usr/lpp/ppe.poe/include/thread/mpif.h
tree_walk.o: /usr/lpp/ppe.poe/include/thread/mpif.h


#--- Module-Dependencies

check_table.o: treevars.o
diagnose_tree.o: treevars.o
draw2d.o: treevars.o
draw2d_hash.o: treevars.o
draw_domains.o: treevars.o
draw_lists.o: treevars.o
draw_map.o: treevars.o
draw_tree2d.o: treevars.o
fields.o: treevars.o
fields_p.o: treevars.o utils.o
get_address.o: treevars.o
get_next_node.o: treevars.o
get_node.o: treevars.o
key_test.o: treevars.o
make_hashentry.o: treevars.o
setup_treearrays.o: treevars.o
sum_bfield.o: treevars.o
sum_bond.o: treevars.o
sum_force.o: treevars.o
sum_lennardjones.o: treevars.o
tree_branches.o: treevars.o tree_utils.o
tree_build.o: treevars.o
tree_domains.o: treevars.o tree_utils.o utils.o
tree_fill.o: treevars.o tree_utils.o
tree_prefetch.o: treevars.o tree_utils.o
tree_properties.o: treevars.o tree_utils.o
tree_update.o: treevars.o tree_utils.o
tree_walk.o: treevars.o tree_utils.o utils.o


